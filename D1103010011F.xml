<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="577" Id="D1103010011F" Left="8" OnLoadCompleted="D1103010011F_OnLoadCompleted" OnUnloadCompleted="D1103010011F_OnUnloadCompleted" PidAttrib="7" Title="안전관리&#32;투자비&#32;실적등록_D1103010011F" Top="8" Ver="1.0" Width="1005" WorkArea="false">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_InvRst" OnColumnChanged="ds_InvRst_OnColumnChanged">
				<Contents>
					<colinfo id="INSPECT_YEAR" size="256" type="STRING"/>
					<colinfo id="SAFE_MANAGE_ITEM" size="256" type="STRING"/>
					<colinfo id="SAFE_MANAGE_OBJ_YN" size="256" type="STRING"/>
					<colinfo id="DETA_DESC_TITACNT_ITEM_CD" size="256" type="STRING"/>
					<colinfo id="UPD_EMPID" size="256" type="STRING"/>
					<colinfo id="UPD_IP" size="256" type="STRING"/>
					<colinfo id="CRT_EMPID" size="256" type="STRING"/>
					<colinfo id="CRT_IP" size="256" type="STRING"/>
					<colinfo id="RMK" size="256" type="STRING"/>
					<colinfo id="RELAT_DEPT_CD" size="256" type="STRING"/>
					<colinfo id="BASIC_JAN" size="256" type="STRING"/>
					<colinfo id="BASIC_FEB" size="256" type="STRING"/>
					<colinfo id="BASIC_MAR" size="256" type="STRING"/>
					<colinfo id="BASIC_APR" size="256" type="STRING"/>
					<colinfo id="BASIC_MAY" size="256" type="STRING"/>
					<colinfo id="BASIC_JUN" size="256" type="STRING"/>
					<colinfo id="BASIC_JUL" size="256" type="STRING"/>
					<colinfo id="BASIC_AUG" size="256" type="STRING"/>
					<colinfo id="BASIC_SEP" size="256" type="STRING"/>
					<colinfo id="BASIC_OCT" size="256" type="STRING"/>
					<colinfo id="BASIC_NOV" size="256" type="STRING"/>
					<colinfo id="BASIC_DEC" size="256" type="STRING"/>
					<colinfo id="ADJUST_JAN" size="256" type="STRING"/>
					<colinfo id="ADJUST_FEB" size="256" type="STRING"/>
					<colinfo id="ADJUST_MAR" size="256" type="STRING"/>
					<colinfo id="ADJUST_APR" size="256" type="STRING"/>
					<colinfo id="ADJUST_MAY" size="256" type="STRING"/>
					<colinfo id="ADJUST_JUN" size="256" type="STRING"/>
					<colinfo id="ADJUST_JUL" size="256" type="STRING"/>
					<colinfo id="ADJUST_AUG" size="256" type="STRING"/>
					<colinfo id="ADJUST_SEP" size="256" type="STRING"/>
					<colinfo id="ADJUST_OCT" size="256" type="STRING"/>
					<colinfo id="ADJUST_NOV" size="256" type="STRING"/>
					<colinfo id="ADJUST_DEC" size="256" type="STRING"/>
					<colinfo id="ADJUST_TOT" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_InvRstReg"></Dataset>
		</Datasets>
		<Shape BKColor="user6" Bottom="69" Height="39" Id="Shape1" Left="5" LineColor="user7" Right="1000" RoundHeight="3" RoundUnit="Pixel" RoundWidth="3" TabOrder="8" Top="30" Type="RoundRect" Width="995"></Shape>
		<Shape BKColor="user8" Bottom="64" Height="29" Id="Shape2" Left="10" LineWidth="0" Right="995" RoundHeight="3" RoundUnit="Pixel" RoundWidth="3" TabOrder="9" Top="35" Type="Rectangle" Width="985"></Shape>
		<Image Align="Left" Height="6" Id="Image7" ImageID="blt" Left="17" LeftMargin="12" Style="blt_search_Indis" TabOrder="5" Text="항목" Top="46" Width="84"></Image>
		<Image Align="Left" Height="6" Id="Image3" ImageID="blt" Left="325" LeftMargin="12" Style="blt_search" TabOrder="6" Text="대상" Top="46" Width="95"></Image>
		<Combo Border="Flat" Height="18" Id="cob_SafeManageObjYn" Left="365" Style="combo" TabOrder="3" Top="39" Width="140"></Combo>
		<Image Align="Left" Height="6" Id="Image10" ImageID="blt" Left="515" LeftMargin="12" Style="blt_search" TabOrder="7" Text="세부내용" Top="46" Width="84"></Image>
		<Div DisableBKColor="white" Height="30" Id="Div0" Left="5" OnLoadCompleted="ComButton_OnLoadCompleted" OnTimer="ComButton_OnTimer" TabOrder="10" Text="Div0" Url="globals::ComHead.xml" Visible="FALSE" Width="995">
			<Contents></Contents>
		</Div>
		<Combo Border="Flat" Height="18" Id="cob_SafeManageItem" Left="56" Style="combo_indis" TabOrder="1" Top="40" Width="140"></Combo>
		<Combo Border="Flat" Height="18" Id="cob_DetaDescTitacntItemCd" Left="579" Style="combo" TabOrder="4" Top="39" Width="140"></Combo>
		<Shape BKColor="#6cbae1" Bottom="93" Height="3" Id="Shape0" Left="5" LineWidth="0" Right="1000" TabOrder="12" Top="90" Type="Rectangle" Width="995"></Shape>
		<Grid AutoEnter="TRUE" BindDataset="Ds_InvRst" BkColor2="user3" BoldHead="FALSE" Border="Flat" Bottom="576" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="483" Id="grd_InvRst" InputPanel="FALSE" Left="5" LineColor="default" LineType="ExVERT" MultiSelect="TRUE" Right="1000" ScrollCell="true" SelColor="BACKGROUND" Style="grid" TabOrder="11" TabStop="true" Top="93" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="995">
			<contents>
				<format id="Default">
					<columns>
						<col fix="left" width="100"/>
						<col fix="left" width="100"/>
						<col fix="left" width="100"/>
						<col fix="left" width="100"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="80"/>
						<col width="80"/>
						<col width="80"/>
					</columns>
					<head>
						<cell bkcolor="user11" col="0" display="normal" text="대상"/>
						<cell bkcolor="user11" col="1" display="text" text="세부내용"/>
						<cell col="2" display="text" text="관련부서"/>
						<cell col="3" display="text" text="적요"/>
						<cell col="4" display="text" text="1월"/>
						<cell col="5" display="text" text="2월"/>
						<cell col="6" display="text" text="3월"/>
						<cell col="7" display="text" text="4월"/>
						<cell col="8" display="text" text="5월"/>
						<cell col="9" display="text" text="6월"/>
						<cell col="10" display="text" text="7월"/>
						<cell col="11" display="text" text="8월"/>
						<cell col="12" display="text" text="9월"/>
						<cell col="13" display="text" text="10월"/>
						<cell col="14" display="text" text="11월"/>
						<cell col="15" display="text" text="12월"/>
						<cell col="16" display="text" text="계"/>
					</head>
					<body>
						<cell col="0" colid="SAFE_MANAGE_OBJ_YN" display="normal" expandsize="18" wordwrap="word"/>
						<cell col="1" colid="DETA_DESC_TITACNT_ITEM_CD" display="text" expandsize="18" wordwrap="word"/>
						<cell col="2" colid="RELAT_DEPT_CD" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell col="3" colid="RMK" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell col="4" colid="ADJUST_JAN" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell col="5" colid="ADJUST_FEB" display="text" edit="normal"/>
						<cell col="6" colid="ADJUST_MAR" display="text" edit="normal"/>
						<cell col="7" colid="ADJUST_APR" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell col="8" colid="ADJUST_MAY" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell col="9" colid="ADJUST_JUN" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell col="10" colid="ADJUST_JUL" display="text" edit="normal"/>
						<cell col="11" colid="ADJUST_AUG" display="text" edit="normal"/>
						<cell col="12" colid="ADJUST_SEP" display="text" edit="normal"/>
						<cell col="13" colid="ADJUST_OCT" display="text" edit="normal"/>
						<cell col="14" colid="ADJUST_NOV" display="text" edit="normal"/>
						<cell col="15" colid="ADJUST_DEC" display="text" edit="normal"/>
						<cell col="16" colid="ADJUST_TOT" display="text"/>
					</body>
					<summary>
						<cell align="center" bkcolor="user13" col="0" colspan="4" display="text" text="총계"/>
						<cell align="center" bkcolor="user13" col="4" display="text" expr='SumNF(&quot;ADJUST_JAN&quot;)'/>
						<cell align="center" bkcolor="user13" col="5" display="text" expr='SumNF(&quot;ADJUST_FEB&quot;)'/>
						<cell align="center" bkcolor="user13" col="6" display="text" expr='SumNF(&quot;ADJUST_MAR&quot;)'/>
						<cell align="center" bkcolor="user13" col="7" display="text" expr='SumNF(&quot;ADJUST_APR&quot;)'/>
						<cell align="center" bkcolor="user13" col="8" display="text" expr='SumNF(&quot;ADJUST_MAY&quot;)'/>
						<cell align="center" bkcolor="user13" col="9" display="text" expr='SumNF(&quot;ADJUST_JUN&quot;)'/>
						<cell align="center" bkcolor="user13" col="10" display="text" expr='SumNF(&quot;ADJUST_JUL&quot;)'/>
						<cell align="center" bkcolor="user13" col="11" display="text" expr='SumNF(&quot;ADJUST_AUG&quot;)'/>
						<cell align="center" bkcolor="user13" col="12" display="text" expr='SumNF(&quot;ADJUST_SEP&quot;)'/>
						<cell align="center" bkcolor="user13" col="13" display="text" expr='SumNF(&quot;ADJUST_OCT&quot;)'/>
						<cell align="center" bkcolor="user13" col="14" display="text" expr='SumNF(&quot;ADJUST_NOV&quot;)'/>
						<cell align="center" bkcolor="user13" col="15" display="text" expr='SumNF(&quot;ADJUST_DEC&quot;)'/>
						<cell align="center" bkcolor="user13" col="16" display="text" expr='SumNF(&quot;ADJUST_TOT&quot;)'/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Image Align="Left" Height="10" Id="Image0" ImageID="blt_8" Left="5" LeftMargin="12" Style="text_title" TabOrder="13" Text="안전관리를&#32;위한&#32;R&amp;D&#32;투자비" Top="75" Width="210"></Image>
		<Image Align="Left" Height="6" Id="Image2" ImageID="blt" Left="206" LeftMargin="12" Style="blt_search_Indis" TabOrder="14" Text="년도" Top="48" Width="84"></Image>
		<Spin Border="Flat" Height="18" Id="sp_Year" Left="246" Style="spin_indis" TabOrder="2" Text="2008" Top="41" Width="54"></Spin>
	</Form>
	<Script><![CDATA[/***************************************************************************************************
* FormID     : D1103010011F.xml
* Form 설명  : 안전투자비 실적등록
* 시스템 명  : 안전공급 (D1)
* 작성자     : 김태화 
* 작성일     : 2009-01-13
* 변경내용   : 
****************************************************************************************************/

#include "JS::COMMONA10001.js";
#include "JS::COMMONA10002.js";

function D1103010011F_OnLoadCompleted(obj)
{
	gfn_LoadForm(obj);
	
	//-----------------------------------------
	//  콤보박스의 내용을 셋팅한다.
	//-----------------------------------------
	gfn_SetComboBox_Comcode("D10005",gfn_setDsObject_Comcode("cob_SafeManageItem"));  //항목
	gfn_SetComboBox_Comcode("D10034",gfn_setDsObject_Comcode("cob_SafeManageObjYn")); //대상
	gfn_SetComboBox_Comcode("D10095",gfn_setDsObject_Comcode("cob_DetaDescTitacntItemCd")); //세부내용
	
	cob_SafeManageItem.Index = 0;
}

//------------------------------------------------------------------------------- 
// 함수명: fn_CommonSearch()
//   설명: 안전투자비 실적등록 조회
// arguments   
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_CommonSearch()
{
	f1_D1_SetComboInit();
	fn_D1_InvRst();
}

function fn_D1_InvRst()
{
	var strSvcID = "fn_D1_InvRst";
	var strPart = "D10";
	var strURL = "handle.do?ServiceName=D1_SafetyMangeCostResltMgr-service&INSPECT_YEAR="+sp_Year.Value+"&SAFE_MANAGE_ITEM="+cob_SafeManageItem.Value+"&SAFE_MANAGE_OBJ_YN="+cob_SafeManageObjYn.Value+"&DETA_DESC_TITACNT_ITEM_CD="+cob_DetaDescTitacntItemCd.Value;
	var strInDatasets  = "";
	var strOutDatasets  = "ds_InvRst=ds_InvRst";
	var strArgument  = "findRst";
	
	gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
			   
	if(ErrorCode < 0)
	{    
		alert(ErrorMsg);
		return;
	}
	
}

//------------------------------------------------------------------------------- 
// 함수명: f1_D1_SetComboInit()
//   설명: 안전투자비 실적등록 그리드 관련 콤보박스 초기화
// arguments   
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function f1_D1_SetComboInit()
{
	gfn_SetGrdComboBox_Comcode("grd_InvRst",0,"D10034"); //대상
	gfn_SetGrdComboBox_Comcode("grd_InvRst",1,"D10095"); //세부내용
	gfn_SetGrdComboBox_Comcode("grd_InvRst",2,"A10414"); //관련부서
	grd_InvRst.SetCellProp("body",0,"Edit","none");
	grd_InvRst.SetCellProp("body",1,"Edit","none");
}

//------------------------------------------------------------------------------- 
// 함수명: fn_CommonSave()
//   설명: 안전투자비 실적을 등록하는 함수
// arguments   
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_CommonSave()
{
	fn_D1_SaveInvRst();
}

//------------------------------------------------------------------------------- 
// 함수명: fn_D1_SaveInvRst()
//   설명: 안전투자비 계획을 등록하는 함수
// arguments   
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_SaveInvRst()
{
	
	for(var i=0;i<ds_InvRst.RowCount();i++)
	{
		if(ds_InvRst.GetRowType(i) != "normal")
		{
			var strType = "insert";
			var strChkFlag = fn_D1_CheckReg(ds_InvRst.GetColumn(i,"SAFE_MANAGE_OBJ_YN"),ds_InvRst.GetColumn(i,"DETA_DESC_TITACNT_ITEM_CD"));
			
			if(!strChkFlag) 
			{
				strType = "update";
			}
			ds_InvRst.UpdateControl = false;
			ds_InvRst.SetRowType(i,strType);
			
			//등록시 셋팅할 사용자 정보
			ds_InvRst.SetColumn(i, "UPD_EMPID", gfn_GetGlobalValue("G_USER_NO"));
			ds_InvRst.SetColumn(i, "UPD_IP", gfn_GetGlobalValue("G_IPADDRESS"));
			ds_InvRst.SetColumn(i, "CRT_EMPID", gfn_GetGlobalValue("G_USER_NO"));
			ds_InvRst.SetColumn(i, "CRT_IP", gfn_GetGlobalValue("G_IPADDRESS"));
			ds_InvRst.SetColumn(i, "INSPECT_YEAR", sp_Year.Text);
			ds_InvRst.SetColumn(i, "SAFE_MANAGE_ITEM", cob_SafeManageItem.Value);
		}
	}
	var strSvcID = "savePipe";
	var strPart = "D10";
	var strURL = "handle.do?ServiceName=D1_SafetyMangeCostResltMgr-service";
	var strInDatasets  = "ds_InvRst=ds_InvRst:u";
	var strOutDatasets  = "";
	var strArgument  = "savaReg";
	
	gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
			   
	if(ErrorCode < 0)
	{    
		alert(ErrorMsg);
		return;
	}
	
	alert(gfn_GetMessage("M000009","%AAA%","저장을"));
	
	fn_CommonSearch();
}

//------------------------------------------------------------------------------- 
// 함수명: fn_D1_CheckReg()
//   설명: 등록을 하기 전 기 등록 여부 확인
// arguments   
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_CheckReg(SAFE_MANAGE_OBJ_YN,DETA_DESC_TITACNT_ITEM_CD)
{	
	//-------------------------------------------------------------------------------
	//  Transition   : Service id
	//  ServicePart   : Service part
	//  Url   : Server url
	//  InputDsList   : Input Dataset List
	//  OutputDsList   : Output Dataset List;
	//  Argument   :  Argument
	//-------------------------------------------------------------------------------
    var strSvcID     = "fn_D1_CheckReg";
    var strPart     = "D10";
    var strURL = "handle.do?ServiceName=D1_SafetyMangeCostResltMgr-service&INSPECT_YEAR="+sp_Year.Value+"&SAFE_MANAGE_ITEM="+cob_SafeManageItem.Value+"&SAFE_MANAGE_OBJ_YN="+SAFE_MANAGE_OBJ_YN+"&DETA_DESC_TITACNT_ITEM_CD="+DETA_DESC_TITACNT_ITEM_CD;
    var strInDatasets     = "";
    var strOutDatasets = "ds_InvRstReg=ds_InvRstReg";
    var strArgument      = "findRegFlag";   
    
    gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
	if(ds_InvRstReg.RowCount() != 0) return false;
	return true;
}

function ds_InvRst_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	var srtTot = 0;
	
	srtTot = ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_JAN")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_FEB")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_MAR")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_APR")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_MAY")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_JUN")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_JUL")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_AUG")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_SEP")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_OCT")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_NOV")) 
		   + ParseInt(ds_InvRst.GetColumn(nRow,"ADJUST_DEC")) ;
	if(varOldValue != varNewValue)ds_InvRst.SetColumn(nRow,"ADJUST_TOT",srtTot);
}


function D1103010011F_OnUnloadCompleted(obj)
{
	if(ds_InvRst.GetUpdate()){
		if(!confirm(gfn_GetMessage("M000016","%AAA%","변경된 내용이 있습니다.종료")))
		{
			return false;
		}
	}
}
]]></Script>
</Window>