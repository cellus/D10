<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="536" Id="D1503010011U" Left="8" OnLoadCompleted="D1503010011U_OnLoadCompleted" PidAttrib="7" Title="안전수칙(투자.외부)_D1503010011U" Top="8" Ver="1.0" Width="660" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_Sign">
				<Contents>
					<colinfo id="DANGER_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="DANGER_JOB_FLAG" size="256" summ="default" type="STRING"/>
					<colinfo encrypt="base64" id="SIGN" size="256" summ="default" type="BLOB"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Static Align="Center" Border="Flat" Height="31" Id="Static1" Left="124" Style="table" TabOrder="9" Text="업체명" Top="471" VAlign="Middle" Width="47" WordWrap="TRUE"></Static>
		<Static Align="Center" BKColor="white" Border="None" Height="29" Id="edt_DangerNum" Left="124" Style="table" TabOrder="20" Top="503" VAlign="Middle" Width="231" WordWrap="TRUE"></Static>
		<Image Align="Left" Height="39" Id="Image0" ImageID="popup_top" LeftMargin="33" Style="popup_title" TabOrder="1" Text="안전수칙(투자.외부)" Transparent="TRUE" Width="660"></Image>
		<Shape BKColor="user16" Bottom="79" Height="5" Id="Shape1" Left="0" LineWidth="0" Right="659" TabOrder="2" Top="74" Type="Rectangle" Width="659"></Shape>
		<Static Align="Center" Border="Flat" Height="369" Id="Static139" Style="table" TabOrder="7" Text="안전조치&#32;준수사항" Top="79" VAlign="Middle" Width="125" WordWrap="TRUE"></Static>
		<Static BKColor="white" Border="Flat" Height="38" Id="Static127" Left="124" Style="table" TabOrder="3" Text="&#32;1.&#32;작업전&#32;안전장비를&#32;점검하여&#32;최상의&#32;상태로&#32;사용한다." Top="79" VAlign="Middle" Width="535" WordWrap="TRUE"></Static>
		<Static BKColor="white" Border="Flat" Height="38" Id="Static128" Left="124" Style="table" TabOrder="4" Text="&#32;2.&#32;작업전&#32;안전에&#32;대하여&#32;대화하고&#32;합의한&#32;후&#32;실천한다.&#32;" Top="116" VAlign="Middle" Width="535" WordWrap="TRUE"></Static>
		<Static BKColor="white" Border="Flat" Height="38" Id="Static129" Left="124" Style="table" TabOrder="5" Text="&#32;3.&#32;밸브철개&#32;열기전&#32;허리운동&#32;실시하여&#32;요통사고&#32;예방한다." Top="153" VAlign="Middle" Width="535" WordWrap="TRUE"></Static>
		<Static BKColor="white" Border="Flat" Height="38" Id="Static137" Left="124" Style="table" TabOrder="6" Text="&#32;4.&#32;밀폐공간&#32;출입전&#32;가스누출여부&#32;및&#32;산소농도&#32;측정한다." Top="190" VAlign="Middle" Width="535" WordWrap="TRUE"></Static>
		<Static Align="Center" Border="Flat" Height="60" Id="Static0" Style="table" TabOrder="8" Text="안전교육실시확인" Top="471" VAlign="Middle" Width="125" WordWrap="TRUE"></Static>
		<Static Align="Center" Border="Flat" Height="30" Id="Static2" Left="124" Style="table" TabOrder="10" Text="성명" Top="501" VAlign="Middle" Width="47" WordWrap="TRUE"></Static>
		<Div Height="29" Id="Div0" TabOrder="11" Text="Div0" Top="39" Url="globals::ComButton.xml" Width="659">
			<Contents></Contents>
		</Div>
		<Static BKColor="white" Border="Flat" Height="38" Id="Static4" Left="124" Style="table" TabOrder="12" Text="&#32;5.&#32;위험작업&#32;현장에는&#32;안전장비와&#32;소화기를&#32;비치한다." Top="227" VAlign="Middle" Width="535" WordWrap="TRUE"></Static>
		<Static BKColor="white" Border="Flat" Height="38" Id="Static5" Left="124" Style="table" TabOrder="13" Text="&#32;6.&#32;밀폐공간에서의&#32;가스방출은&#32;어떤&#32;경우라도&#32;엄금한다." Top="264" VAlign="Middle" Width="535" WordWrap="TRUE"></Static>
		<Static BKColor="white" Border="Flat" Height="38" Id="Static6" Left="124" Style="table" TabOrder="14" Text="&#32;7.&#32;질소&#32;치환&#32;완벽하게&#32;시행한&#32;후&#32;절단작업&#32;시행한다." Top="301" VAlign="Middle" Width="535" WordWrap="TRUE"></Static>
		<Static BKColor="white" Border="Flat" Height="38" Id="Static7" Left="124" Style="table" TabOrder="15" Text="&#32;8.&#32;스토퍼는&#32;이중설치하고&#32;종료시까지&#32;확실하게&#32;감시한다." Top="338" VAlign="Middle" Width="535" WordWrap="TRUE"></Static>
		<Static BKColor="white" Border="Flat" Height="38" Id="Static8" Left="124" Style="table" TabOrder="16" Text="&#32;9.&#32;작업현장주변에는&#32;절대금연하고&#32;화기접근을&#32;통제한다." Top="373" VAlign="Middle" Width="535" WordWrap="TRUE"></Static>
		<Static BKColor="white" Border="Flat" Height="38" Id="Static9" Left="124" Style="table" TabOrder="17" Text="&#32;10.&#32;퍼지작업시&#32;방출가스의&#32;안전확보&#32;다시&#32;한번&#32;확인한다." Top="410" VAlign="Middle" Width="535" WordWrap="TRUE"></Static>
		<Static Align="Center" BKColor="white" Border="Flat" Height="31" Id="edt_WorkFirmCdNm" Left="170" Style="table" TabOrder="18" Top="471" VAlign="Middle" Width="216" WordWrap="TRUE"></Static>
		<Static Align="Center" BKColor="white" Border="Flat" Height="30" Id="edt_SiteChiefNm" Left="170" Style="table" TabOrder="19" Top="501" VAlign="Middle" Width="216" WordWrap="TRUE"></Static>
		<Sign BindDataset="ds_Sign" Border="FLAT" Column="SIGN" Height="61" Id="sign" Left="387" TabOrder="21" Text="(서명)" Top="471" Width="270"></Sign>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="19" Id="Button41" ImageID="btn_4_Close&#32;cancellation" Left="580" LeftMargin="21" OnClick="Button0_OnClick" Style="button" TabOrder="22" Text="서명취소" Top="450" Width="76"></Button>
		<File Bottom="64" Height="24" Id="File1" Left="688" Right="712" TabOrder="22" Top="40" Width="24"></File>
		<Image BindDataset="ds_Sign" Border="Flat" Column="SIGN" Height="61" Id="SignImg" Left="387" TabOrder="23" Top="471" Width="270"></Image>
	</Form>
	<Script><![CDATA[#include "JS::COMMONA10001.js";

var DangerJobFlag = "";

function D1503010011U_OnLoadCompleted(obj)
{
	gfn_LoadForm(obj);
	
	if(WORK_FIRM_CD == "" && SITE_CHIEF_NM == ""){
		edt_WorkFirmCdNm.Text = "";
		edt_SiteChiefNm.Text = "";
	}else if(WORK_FIRM_CD != "" && SITE_CHIEF_NM == ""){
		edt_WorkFirmCdNm.Text = WORK_FIRM_CD;
		edt_SiteChiefNm.Text = "";
	}else if(WORK_FIRM_CD == "" && SITE_CHIEF_NM != null){
		edt_WorkFirmCdNm.Text = "";
		edt_SiteChiefNm.Text = SITE_CHIEF_NM;		
	}else if(WORK_FIRM_CD != "" && SITE_CHIEF_NM != null){
		edt_WorkFirmCdNm.Text = WORK_FIRM_CD;
		edt_SiteChiefNm.Text = SITE_CHIEF_NM;		
	}

	// edt_WorkFirmCdNm.Text = WORK_FIRM_CD;
	// edt_SiteChiefNm.Text = SITE_CHIEF_NM;
	DangerJobFlag = DANGER_JOB_FLAG;
	edt_DangerNum.Text = replace(DANGER_NUM,"%$","");	
	
	fn_D11_FindList();
}

function fn_CommonExcelExport()
{
	grd_list.ExportExcel("sheet1");
}

function fn_CommonPrint()
{
	PrintScreen(true);
}

function fn_D11_FindList()
{
	var strSvcID = "";
	var strPart = "D10";	
	var strURL = "handle.do?ServiceName=D1_DangerWorkRequirEMgr-service&SignSearch=1"
				+"&DANGER_JOB_FLAG=" +DangerJobFlag
				+"&DANGER_NUM=" + replace(DANGER_NUM,"%$","")
				;  
	var strInDatasets  = "";
	var strOutDatasets  = "ds_Sign=ds_Sign";
	var strArgument  = "";
	
	gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
	
	if( length(ds_Sign.GetColumn(0, "SIGN")) > 0 )
	{
		SignImg.Visible = true;
		sign.Visible    = false;
	}
	else
	{
		SignImg.Visible = false;
		sign.Visible    = true;
	}
	
	// 2013.06.11. 이건민 - 버그수정 (BLOB은 NULL 체크 못함)
	/*
	if(ds_Sign.GetColumn(0, "SIGN") == null || ds_Sign.GetColumn(0, "SIGN") == ''){
		SignImg.Visible = false;
		sign.Visible    = true;
	}else{
		SignImg.Visible = true;
		sign.Visible    = false;
	}
	*/
}

function fn_CommonSave()
{
	fn_update();
}

function fn_update()
{
	ds_Sign.UpdateControl = false;
	ds_Sign.SetRowType(0,"update");
	
	sign.SaveFile("JPG", "C:\\test.jpg");
	File1.FileName = "C:\\test.jpg";
	if (File1.open('rb'))
	{
		var sbuff;
		sbuff = File1.ReadBinary();
		File1.Close();
		ds_Sign.SetColumn(0, "SIGN", sbuff);
	}
	
	ds_Sign.SetColumn(0, "DANGER_NUM", replace(DANGER_NUM,"%$",""));
	ds_Sign.SetColumn(0, "DANGER_JOB_FLAG", DANGER_JOB_FLAG);
	
	var strSvcID = "";
	var strPart = "D10";
	var strURL = "handle.do?ServiceName=D1_DangerWorkRequirEMgr-service&sign=1"
				;
	var strInDatasets  = "ds_Sign=ds_Sign:u";
	var strOutDatasets  = "";
	var strArgument  = "";
	
	gfn_SyncCall(
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
				  );
				  
    if ( ErrorCode > 0 )
	{
		return false;
	}
	
	alert("저장 되었습니다.");
}

function Button0_OnClick(obj)
{
	sign.Clear();
	
	SignImg.Visible = false;
	sign.Visible    = true;
}
]]></Script>
</Window>