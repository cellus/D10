<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="730" Id="D1201010010F_D01" Left="8" OnLoadCompleted="D1201010010F_D01_OnLoadCompleted" PidAttrib="7" Title="순찰점검&#32;월&#32;계획조회" Top="8" Ver="1.0" Width="1260" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_calendar">
				<Contents>
					<colinfo id="day0" size="256" type="STRING"/>
					<colinfo id="day1" size="256" type="STRING"/>
					<colinfo id="day2" size="256" type="STRING"/>
					<colinfo id="day3" size="256" type="STRING"/>
					<colinfo id="day4" size="256" type="STRING"/>
					<colinfo id="day5" size="256" type="STRING"/>
					<colinfo id="day6" size="256" type="STRING"/>
					<colinfo id="note0" size="256" type="STRING"/>
					<colinfo id="note1" size="256" type="STRING"/>
					<colinfo id="note2" size="256" type="STRING"/>
					<colinfo id="note3" size="256" type="STRING"/>
					<colinfo id="note4" size="256" type="STRING"/>
					<colinfo id="note5" size="256" type="STRING"/>
					<colinfo id="note6" size="256" type="STRING"/>
					<colinfo id="base_note0" size="256" type="STRING"/>
					<colinfo id="base_note1" size="256" type="STRING"/>
					<colinfo id="base_note2" size="256" type="STRING"/>
					<colinfo id="base_note3" size="256" type="STRING"/>
					<colinfo id="base_note4" size="256" type="STRING"/>
					<colinfo id="base_note5" size="256" type="STRING"/>
					<colinfo id="base_note6" size="256" type="STRING"/>
					<colinfo id="hol0" size="256" type="STRING"/>
					<colinfo id="hol1" size="256" type="STRING"/>
					<colinfo id="hol2" size="256" type="STRING"/>
					<colinfo id="hol3" size="256" type="STRING"/>
					<colinfo id="hol4" size="256" type="STRING"/>
					<colinfo id="hol5" size="256" type="STRING"/>
					<colinfo id="hol6" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_1" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_2" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_3" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_4" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_5" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_6" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_0" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_base_note">
				<Contents>
					<colinfo Id="date" Size="256" Type="STRING"/>
					<colinfo Id="note" Size="256" Type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list">
				<Contents>
					<colinfo id="FACI_NUM" size="256" type="STRING"/>
					<colinfo id="PLAN_YMD" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT" size="256" type="STRING"/>
					<colinfo id="WEEK" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_0" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_1" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_2" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_3" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_4" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_5" size="256" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_6" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_calendar_copy">
				<Contents>
					<colinfo id="day0" size="256" summ="default" type="STRING"/>
					<colinfo id="day1" size="256" summ="default" type="STRING"/>
					<colinfo id="day2" size="256" summ="default" type="STRING"/>
					<colinfo id="day3" size="256" summ="default" type="STRING"/>
					<colinfo id="day4" size="256" summ="default" type="STRING"/>
					<colinfo id="day5" size="256" summ="default" type="STRING"/>
					<colinfo id="day6" size="256" summ="default" type="STRING"/>
					<colinfo id="note0" size="256" summ="default" type="STRING"/>
					<colinfo id="note1" size="256" summ="default" type="STRING"/>
					<colinfo id="note2" size="256" summ="default" type="STRING"/>
					<colinfo id="note3" size="256" summ="default" type="STRING"/>
					<colinfo id="note4" size="256" summ="default" type="STRING"/>
					<colinfo id="note5" size="256" summ="default" type="STRING"/>
					<colinfo id="note6" size="256" summ="default" type="STRING"/>
					<colinfo id="base_note0" size="256" summ="default" type="STRING"/>
					<colinfo id="base_note1" size="256" summ="default" type="STRING"/>
					<colinfo id="base_note2" size="256" summ="default" type="STRING"/>
					<colinfo id="base_note3" size="256" summ="default" type="STRING"/>
					<colinfo id="base_note4" size="256" summ="default" type="STRING"/>
					<colinfo id="base_note5" size="256" summ="default" type="STRING"/>
					<colinfo id="base_note6" size="256" summ="default" type="STRING"/>
					<colinfo id="hol0" size="256" summ="default" type="STRING"/>
					<colinfo id="hol1" size="256" summ="default" type="STRING"/>
					<colinfo id="hol2" size="256" summ="default" type="STRING"/>
					<colinfo id="hol3" size="256" summ="default" type="STRING"/>
					<colinfo id="hol4" size="256" summ="default" type="STRING"/>
					<colinfo id="hol5" size="256" summ="default" type="STRING"/>
					<colinfo id="hol6" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_1" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_2" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_3" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_4" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_5" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_6" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_RST_COUNT_0" size="256" summ="default" type="STRING"/>
					<colinfo id="date" size="256" summ="default" type="STRING"/>
					<colinfo id="note" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Grid AutoFit="TRUE" AutoScrollBar="None" BkColor2="default" BoldHead="FALSE" Border="Flat" Bottom="721" ColSelect="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="25" Height="700" Id="Grid_calendar" InputPanel="FALSE" Left="5" LineColor="default" LineType="ExVERT" MinWidth="100" OnCellClick="Grid_calendar_OnCellClick" OnHeadClick="grid_calendar_OnHeadClick" Right="1256" RowHeight="22" Style="grid" TabOrder="1" TabStop="FALSE" Top="21" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1251">
			<contents>
				<format id="Default">
					<columns>
						<col width="24"/>
						<col width="155"/>
						<col width="24"/>
						<col width="155"/>
						<col width="24"/>
						<col width="155"/>
						<col width="24"/>
						<col width="155"/>
						<col width="24"/>
						<col width="155"/>
						<col width="24"/>
						<col width="155"/>
						<col width="24"/>
						<col width="155"/>
					</columns>
					<head>
						<cell col="0" colspan="2" cursor="hand" display="text" text="◀"/>
						<cell col="2" colspan="10" display="text" font="돋움,11,Bold"/>
						<cell col="12" colspan="2" cursor="hand" display="text" text="▶"/>
						<cell col="0" color="red" colspan="2" display="text" font="돋움,10,Bold" row="1" text="일"/>
						<cell col="2" colspan="2" display="text" font="돋움,10,Bold" row="1" text="월"/>
						<cell col="4" colspan="2" display="text" font="돋움,10,Bold" row="1" text="화"/>
						<cell col="6" colspan="2" display="text" font="돋움,10,Bold" row="1" text="수"/>
						<cell col="8" colspan="2" display="text" font="돋움,10,Bold" row="1" text="목"/>
						<cell col="10" colspan="2" display="text" font="돋움,10,Bold" row="1" text="금"/>
						<cell col="12" color="blue" colspan="2" display="text" font="돋움,10,Bold" row="1" text="토"/>
					</head>
					<body>
						<cell col="0" colspan="2" display="text" rowspan="2">
							<cell col="0" colid="day0" color="red" display="text"/>
							<cell col="0" colid="note0" display="text" row="1" scrollbar="vert"/>
							<cell col="1" colid="GOV_RST_COUNT_0" display="text" row="1"/>
							<cell col="1" colid="base_note0" display="text" scrollbar="vert" wordwrap="word"/>
						</cell>
						<cell col="2" colspan="2" display="text" rowspan="2">
							<cell col="0" colid="day1" color="expr:iif(hol1&#32;==&#32;true,&#32;&apos;red&apos;,&#32;&apos;blue&apos;)" display="text"/>
							<cell align="left" col="0" colid="note1" display="text" row="1" scrollbar="vert"/>
							<cell col="1" colid="GOV_RST_COUNT_1" display="text" row="1"/>
							<cell align="left" col="1" colid="base_note1" display="text"/>
						</cell>
						<cell col="4" colspan="2" display="text" rowspan="2">
							<cell col="0" colid="day2" color="expr:iif(hol2&#32;==&#32;true,&#32;&apos;red&apos;,&#32;&apos;blue&apos;)" display="text"/>
							<cell align="left" col="0" colid="note2" display="text" row="1" scrollbar="vert"/>
							<cell col="1" colid="GOV_RST_COUNT_2" display="text" row="1"/>
							<cell align="left" col="1" colid="base_note2" display="text"/>
						</cell>
						<cell col="6" colspan="2" display="text" rowspan="2">
							<cell col="0" colid="day3" color="expr:iif(hol3&#32;==&#32;true,&#32;&apos;red&apos;,&#32;&apos;blue&apos;)" display="text"/>
							<cell align="left" col="0" colid="note3" display="text" row="1" scrollbar="vert"/>
							<cell col="1" colid="GOV_RST_COUNT_3" display="text" row="1"/>
							<cell align="left" col="1" colid="base_note3" display="text"/>
						</cell>
						<cell col="8" colspan="2" display="text" rowspan="2">
							<cell col="0" colid="day4" color="expr:iif(hol4&#32;==&#32;true,&#32;&apos;red&apos;,&#32;&apos;blue&apos;)" display="text"/>
							<cell align="left" col="0" colid="note4" display="text" row="1" scrollbar="vert"/>
							<cell col="1" colid="GOV_RST_COUNT_4" display="text" row="1"/>
							<cell align="left" col="1" colid="base_note4" display="text"/>
						</cell>
						<cell col="10" colspan="2" display="text" rowspan="2">
							<cell col="0" colid="day5" color="expr:iif(hol5&#32;==&#32;true,&#32;&apos;red&apos;,&#32;&apos;blue&apos;)" display="text"/>
							<cell align="left" col="0" colid="note5" display="text" row="1" scrollbar="vert"/>
							<cell col="1" colid="GOV_RST_COUNT_5" display="text" row="1"/>
							<cell align="left" col="1" colid="base_note5" display="text"/>
						</cell>
						<cell col="12" colspan="2" display="text" rowspan="2">
							<cell align="center" col="0" colid="day6" color="expr:iif(hol6&#32;==&#32;true,&#32;&apos;red&apos;,&#32;&apos;blue&apos;)" display="text"/>
							<cell align="left" col="1" colid="base_note6" display="text"/>
							<cell align="center" col="0" colid="note6" display="text" row="1" scrollbar="vert"/>
							<cell col="1" colid="GOV_RST_COUNT_6" display="text" row="1"/>
						</cell>
					</body>
				</format>
			</contents>
		</Grid>
		<Shape BKColor="user15" Bottom="21" Height="3" Id="Shape0" Left="5" LineWidth="0" Right="1256" TabOrder="2" Top="18" Type="Rectangle" Width="1251"></Shape>
	</Form>
	<Script><![CDATA[#include "JS::COMMONA10001.js";
#include "JS::COMMONA10002.js";
#include "JS::COMMONB30001.js";

var G_MONTH = "";

//  - 휴일 : 휴일 글자
//  - 비휴일 : ""
function IsHoliday(yyyymmdd)
{
  var mmdd;
  var lunar;

  ////// 양력 체크
  mmdd = substr(yyyymmdd, 4, 4);
  // 신정 Check
  if( mmdd == "0101" )
		return "신정";
	// 삼일절
	if( mmdd == "0301" )
		return "삼일절";
	// 어린이날
	if( mmdd == "0505" )
		return "어린이날";
	// 현충일
	if( mmdd == "0606" )
		return "현충일";
	// 제헌절
	if( mmdd == "0717" )
		return "제헌절";
	// 광복절
	if( mmdd == "0815" )
		return "광복절";
	// 개천절
	if( mmdd == "1003" )
		return "개천절";
	// 성탄절
	if( mmdd == "1225" )
		return "성탄절";
		
	/////// 음력 체크
  lunar = Solar2Lunar( yyyymmdd );
	mmdd = substr(lunar, 4, 4);
	// 구정	
	if( mmdd == "1230" || mmdd == "0101" || mmdd == "0102" )
		return "설날";
	// 초파일
	if( mmdd == "0408" )
		return "석가탄신일";
	// 추석
	if( mmdd == "0814" || mmdd == "0815" || mmdd == "0816" )
		return "추석";
  
  // 일요일 Check
	if( GetDay(yyyymmdd) == 0 )
		return "일요일";
		  
  return "";
}

/***************************************************************
 * 설명 : 해당월의 맨마지막 날짜를 찾는 함수
 * arg :
			str_yyyymm
 * return : 
			성공 = 맨 마지막 날짜
			실패 = -1
****************************************************************/
function GetLastDay(str_yyyymm)
{
	var   int_year, int_month;
	var		len;
	var		yy, mm, last_day, dd;
	var		c;

	int_year = ToInteger(substr(str_yyyymm, 0, 4));
	int_month = ToInteger(substr(str_yyyymm, 4, 2));
	if( int_month < 1 || int_month > 12 )
	{
		return -1;
	}
	if ( int_month == 2 )
	{
		if ( (int_year%4) == 0 && (int_year%100) != 0 || (int_year%400) == 0 )
		{
			last_day = 29;
		}
		else
		{
			last_day = 28;
		}
	}
	else if ( int_month == 4 || int_month == 6 || int_month == 9 || int_month == 11 )
	{
		last_day = 30;
	}
	else
	{
		last_day = 31;
	}

	return last_day;
}

// 매월 마다 정보 갱신
// 달력에 쓰일 기본정보 처리 내용
function MakeBaseNote(ds_base_note_obj, yyyymm)
{
	var i;
	var last_day;
	var holiday, lunar, lunar_mm, lunar_dd;
	var row;
	var yyyymmdd;

	ds_base_note_obj.ClearData();
	last_day = GetLastDay(yyyymm);

	// 공휴일 지정
	for( i = 1 ; i < last_day ; i++ )
	{
		yyyymmdd = yyyymm+Lpad(i, "0", 2);
		holiday = IsHoliday(yyyymmdd);
		if( holiday != "" && holiday != "일요일" )
		{
			row = ds_base_note_obj.AddRow();
			ds_base_note_obj.SetColumn(row, "date", yyyymmdd);
			ds_base_note_obj.SetColumn(row, "note", holiday);
		}
	}
	// 음력표기(5일간격)
	for( i = 1 ; i < last_day ; i++ )
	{
		if( i%5 == 1 )
		{
			yyyymmdd = yyyymm+Lpad(i, "0", 2);
			lunar = Solar2Lunar(yyyymmdd);
			lunar_mm = ToInteger(substr(lunar, 4, 2));
			lunar_dd = ToInteger(substr(lunar, 6, 2));
			row = ds_base_note_obj.AddRow();
			ds_base_note_obj.SetColumn(row, "date", yyyymmdd);
			ds_base_note_obj.SetColumn(row, "note", "("+lunar_mm+"."+lunar_dd+")");
		}
	}
}

// 이번달 달력 그리기
function DrawCalendar(ds_calendar_obj, grid_obj, ds_base_note_obj, yyyymm)
{
	var i, day, row, colid;
	var start_day, end_date, today;

	MakeBaseNote(ds_base_note_obj, yyyymm);	
	
	// Grid Header생성
	grid_obj.UserData = yyyymm;
	grid_obj.SetCellProp("head",1,"text",substr(yyyymm, 0, 4) + "년 " + ToInteger(substr(yyyymm, 4,2)) + "월");
	
	// Dataset 만들기
	grid_obj.BindDataset = "";
	ds_calendar_obj.ClearData();
	start_day = GetDay(yyyymm+"01");
	last_date = GetLastDay(yyyymm);
	row = ds_calendar_obj.AddRow();
	
	var v_CurDate;
	var v_ProSYmd;	
	var v_ProEYmd;	
	var v_DeptNm;
    var j = 0; 
	for( i = 1, day = start_day ; i <= last_date ; i++ )
	{
	    v_CurDate = parseInt(yyyymm+Lpad(i, "0", 2));	
	    
	 // 달력 생성			
		ds_calendar_obj.SetColumn(row, "day"+day, i);
		
		if(ds_list.GetColumn(row,"GOV_RST_COUNT_"+day) > 0){
		    
		    ds_calendar_obj.SetColumn(row, "GOV_RST_COUNT_"+day,ds_list.GetColumn(row,"GOV_RST_COUNT_"+day));
		}
		
	 // 휴일 처리
	  if( IsHoliday(yyyymm+Lpad(i, "0", 2)) != "" )
		  ds_calendar_obj.SetColumn(row, "hol"+day, "1"); 
			
	 // ds_base_note --> 달력 Data	
   var base_note_row;
		base_note_row = ds_base_note_obj.FindRow("date", yyyymm+Lpad(i, "0", 2));
		if( base_note_row >= 0 )
			ds_calendar_obj.SetColumn(row, "base_note"+day, ds_base_note_obj.GetColumn(base_note_row, "note"));

		// 달력생성
		day = (day+1)%7;
		if( day == 0 && i != last_date )
			row = ds_calendar_obj.AddRow();
	}
	
	grid_obj.BindDataset = ds_calendar_obj.ID;
	ds_calendar_copy.Copy(ds_calendar_obj.ID);
	// Grid높이 조정
	grid_obj.RowHeight = (grid_obj.Height - grid_obj.HeadHeight*2 - 5)/(ds_calendar_obj.RowCount()*2);
}

// Grid Header Click 처리
function grid_calendar_OnHeadClick(obj,nCell,nX,nY)
{
	var yyyymm;
	yyyymm = obj.UserData;	
	
	if( nCell == 0 )
	{
		yyyymm = substr(AddMonth(yyyymm+"01", -1), 0, 6);
		DrawCalendar(ds_calendar, Grid_calendar, ds_base_note, yyyymm);
		
		G_MONTH = yyyymm;
		
		fn_D1_Search();
	}
	else if( nCell = 2 )
	{
		yyyymm = substr(AddMonth(yyyymm+"01", 1), 0, 6);
		DrawCalendar(ds_calendar, Grid_calendar, ds_base_note, yyyymm);
		
		G_MONTH = yyyymm;
		
		fn_D1_Search();
	}
}
/*
// Grid Expression - 오늘날짜
function grid_today_expr(date)
{
	var yyyymmdd = grid_calendar.UserData+Lpad(date, "0", 2);
	if( Today() == yyyymmdd )
		return "blue";
	else
		return "default";
}
*/

// Form Load시
function D1201010010F_D01_OnLoadCompleted(obj)
{
	gfn_LoadForm(obj);
	
	var yyyymm;
	Grid_calendar.UserData = today();
	yyyymm = substr(today(), 0, 6);
		
	G_MONTH = yyyymm;
	
	Combo5.value = "";
	Combo5.enable = false;
	
	Combo4.value = "";
	Combo4.enable = false;
	Combo5.value = "";
	Combo5.enable = false;
	
	cal_day.value = "";
	cal_day.enable = false;
	cob_FaciFlag.value = "";
	cob_FaciFlag.enable = false;
	
	fn_D1_Search();
}

/********************************************************************************
* 기      능   :  순찰점검 월 계획조회
********************************************************************************/
function fn_D1_Search() {
    
    var strSvcID = "";
    var strPart = "D10";
    var strURL = "handle.do?ServiceName=D1_PatrolMonthCheckMgr-service"
               + "&MONTH="     + G_MONTH
               + "&BRANCH_CD=" + cob_BranchCd.value
               + "&BLOCK_CD="  + cob_PBlockCd.value
               + "&TEAM_CD="   + cob_TeamCd.value
               ;
    var strInDatasets = "";
    var strOutDatasets = "ds_list=ds_list";
    var strArgument = "search";
 
    gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );	  
			   
	DrawCalendar(ds_calendar, Grid_calendar, ds_base_note, G_MONTH);		    
}

function Grid_calendar_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{   
    for (var i = 0; i < 7; i++) {
        if (i == nCell) {
            if (ds_calendar_copy.GetColumn(nRow, "day" + nCell) == "" || ds_calendar_copy.GetColumn(nRow, "day" + nCell) == null) {
				return;
			} else {
			    var date = LPAD(ds_calendar_copy.GetColumn(nRow, "day" + nCell), 0, 2);
				var args = "DATE=" + G_MONTH + date;   
				
				var arrList = gfn_Dialog("D10", "D1201010010U", args, 1100, 600, true, -1, -1);
			}	
        }
    }
}]]></Script>
</Window>