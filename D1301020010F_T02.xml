<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="729" Id="D1301030010F" Left="8" OnLoadCompleted="D1301030010F_OnLoadCompleted" OnUnloadCompleted="D1301030010F_OnUnloadCompleted" PidAttrib="7" Top="8" Ver="1.0" Width="1260" WorkArea="false">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_GovList">
				<Contents>
					<colinfo id="REG_INSPECT_PLAN_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_NO1" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_ROOM_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="LOT_NUM_UNION" size="256" summ="default" type="STRING"/>
					<colinfo id="INST_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="INSPECT_YEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="FACI_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="BRANCH_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="FACI_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="BLOCK_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="TEAM_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="TEAM_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_NO2" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="HILL" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR_M" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR_S" size="256" summ="default" type="STRING"/>
					<colinfo id="SECOND_ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="BLD_DONG" size="256" summ="default" type="STRING"/>
					<colinfo id="HOSU" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_GovResult" OnColumnChanged="ds_GovResult_OnColumnChanged">
				<Contents>
					<colinfo id="INSPECT_YEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="FACI_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="INSPECT_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="UPD_EMPID" size="256" summ="default" type="STRING"/>
					<colinfo id="UPD_IP" size="256" summ="default" type="STRING"/>
					<colinfo id="CRT_EMPID" size="256" summ="default" type="STRING"/>
					<colinfo id="CRT_IP" size="256" summ="default" type="STRING"/>
					<colinfo id="INSPECT" size="256" summ="default" type="STRING"/>
					<colinfo id="NOT_PASS_WHY" size="256" summ="default" type="STRING"/>
					<colinfo id="ACT_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="ACT_DESC" size="256" summ="default" type="STRING"/>
					<colinfo id="RMK" size="256" summ="default" type="STRING"/>
					<colinfo id="NOT_PASS_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="NOT_PASS_YN" size="256" summ="default" type="STRING"/>
					<colinfo id="FACI_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="MAINTER_NUM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_GovRstFlag">
				<Contents>
					<colinfo id="CRT_TIME" size="256" summ="default" type="STRING"/>
					<colinfo id="CRT_EMPNM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_GovListExcel">
				<Contents>
					<colinfo id="REG_INSPECT_PLAN_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_NO1" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_ROOM_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="LOT_NUM_UNION" size="256" summ="default" type="STRING"/>
					<colinfo id="INST_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="INSPECT_YEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="FACI_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="FACI_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="MAINTER_NUM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_GovResultD" OnColumnChanged="ds_GovResult_OnColumnChanged">
				<Contents>
					<colinfo id="INSPECT_YEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="FACI_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="GOV_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="INSPECT_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="UPD_EMPID" size="256" summ="default" type="STRING"/>
					<colinfo id="UPD_IP" size="256" summ="default" type="STRING"/>
					<colinfo id="CRT_EMPID" size="256" summ="default" type="STRING"/>
					<colinfo id="CRT_IP" size="256" summ="default" type="STRING"/>
					<colinfo id="INSPECT" size="256" summ="default" type="STRING"/>
					<colinfo id="NOT_PASS_WHY" size="256" summ="default" type="STRING"/>
					<colinfo id="ACT_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="ACT_DESC" size="256" summ="default" type="STRING"/>
					<colinfo id="RMK" size="256" summ="default" type="STRING"/>
					<colinfo id="NOT_PASS_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="NOT_PASS_YN" size="256" summ="default" type="STRING"/>
					<colinfo id="FACI_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="#6cbae1" Bottom="29" Height="3" Id="Shape0" Left="5" LineWidth="0" Right="1243" TabOrder="2" Top="26" Type="Rectangle" Width="1238"></Shape>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_GovList" BkColor2="user3" BoldHead="FALSE" Border="Flat" Bottom="541" ColSizing="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="512" Id="grd_GovList" InputPanel="FALSE" Left="5" LineColor="default" LineType="ExVERT" MinWidth="100" MultiSelect="TRUE" OnCellClick="grd_GovList_OnCellClick" Right="1243" ScrollCell="true" SelColor="BACKGROUND" Style="grid" TabOrder="1" TabStop="true" Top="29" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1238">
			<contents>
				<format id="Default">
					<columns>
						<col fix="left" width="40"/>
						<col width="120"/>
						<col width="120"/>
						<col width="120"/>
						<col width="110"/>
						<col width="100"/>
						<col width="150"/>
						<col width="457"/>
						<col width="150"/>
					</columns>
					<head>
						<cell col="0" display="normal" text="NO"/>
						<cell col="1" display="text" text="계획일자"/>
						<cell col="2" display="text" text="시/구"/>
						<cell col="3" display="text" text="팀"/>
						<cell col="4" display="text" text="구간"/>
						<cell col="5" display="text" text="정압실번호"/>
						<cell col="6" display="text" text="정압실명"/>
						<cell col="7" display="text" text="주소"/>
						<cell col="8" display="text" text="시공감리일자"/>
					</head>
					<body>
						<cell align="right" col="0" display="normal" expandsize="18" expr="rowindex+1" wordwrap="word"/>
						<cell align="center" col="1" colid="REG_INSPECT_PLAN_YMD" display="date"/>
						<cell align="center" col="2" colid="ZIP_NM" display="text" expandsize="18" wordwrap="word"/>
						<cell col="3" colid="TEAM_NM" display="text"/>
						<cell col="4" colid="BLOCK_NM" display="text"/>
						<cell align="center" col="5" colid="FACI_NM" display="text"/>
						<cell align="left" col="6" colid="GOV_ROOM_NM" display="text" expandsize="18" wordwrap="word"/>
						<cell align="left" col="7" colid="LOT_NUM_UNION" display="text" expandsize="18" wordwrap="word"/>
						<cell align="center" col="8" colid="INST_YMD" display="date"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Image Align="Left" Height="10" Id="Image5" ImageID="blt_8" Left="5" LeftMargin="12" Style="text_title" TabOrder="3" Text="정기검사대상(정압기)" Top="5" Width="210"></Image>
		<Image Align="Left" Height="10" Id="Image0" ImageID="blt_8" Left="4" LeftMargin="12" Style="text_title" TabOrder="6" Text="정기검사결과&#32;등록" Top="548" Width="210"></Image>
		<Shape BKColor="#6cbae1" Bottom="571" Height="3" Id="Shape3" Left="5" LineWidth="0" Right="1243" TabOrder="5" Top="568" Type="Rectangle" Width="1238"></Shape>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_GovResult" BkColor2="default" BoldHead="FALSE" Border="Flat" Bottom="720" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="149" Id="grd_GovRst" InputPanel="FALSE" Left="5" LineColor="default" LineType="ExVERT" MinWidth="100" MultiSelect="TRUE" OnCellClick="grd_List_OnExpandEdit" Right="1243" RowHeight="20" ScrollCell="true" SelColor="BACKGROUND" Style="grid" TabOrder="4" TabStop="true" Top="571" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1238">
			<contents>
				<format id="Default">
					<columns>
						<col width="40"/>
						<col width="100"/>
						<col width="152"/>
						<col width="89"/>
						<col width="100"/>
						<col width="100"/>
						<col width="200"/>
						<col width="100"/>
						<col width="200"/>
						<col width="200"/>
						<col width="80"/>
					</columns>
					<head>
						<cell col="0" display="normal" text="NO"/>
						<cell col="1" display="normal" text="시/구"/>
						<cell col="2" display="text" text="정압실명"/>
						<cell bkcolor="user11" col="3" display="text" text="검사일자"/>
						<cell bkcolor="user11" col="4" display="text" text="검사결과"/>
						<cell col="5" display="normal" text="불합격일자"/>
						<cell col="6" display="text" text="사유"/>
						<cell col="7" display="text" text="조치일자"/>
						<cell col="8" display="text" text="조치내용"/>
						<cell col="9" display="text" text="비고"/>
						<cell col="10" display="text" text="정비보수번호"/>
					</head>
					<body>
						<cell align="right" col="0" display="normal" expandsize="18" expr="rowindex+1" wordwrap="word"/>
						<cell align="center" col="1" colid="ZIP_NO1" display="normal" expandsize="18" wordwrap="word"/>
						<cell align="center" col="2" colid="FACI_NM" display="text" expandsize="18" wordwrap="word"/>
						<cell align="center" col="3" colid="INSPECT_YMD" display="date" expandimage="calendar" expandshow="true" expandsize="18" wordwrap="word"/>
						<cell align="center" col="4" colid="INSPECT_RSLT_CD" display="combo" edit="combo" expandsize="18" wordwrap="word"/>
						<cell align="center" col="5" colid="NOT_PASS_YMD" display="date" expandsize="18" wordwrap="word"/>
						<cell align="left" col="6" colid="NOT_PASS_WHY" display="text" edit="normal" expandsize="18" limit="50" wordwrap="word"/>
						<cell align="center" col="7" colid="ACT_YMD" display="date" expandimage="calendar" expandshow="true" expandsize="18" wordwrap="word"/>
						<cell align="left" col="8" colid="ACT_DESC" display="text" edit="normal" expandsize="18" limit="30" wordwrap="word"/>
						<cell align="left" col="9" colid="RMK" display="text" edit="normal" expandsize="18" limit="30" wordwrap="word"/>
						<cell align="center" col="10" colid="MAINTER_NUM" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="19" Id="Button223" ImageID="btn_6_reg" Left="1143" LeftMargin="21" OnClick="fn_Maint_Repai_Reque" Style="button" TabOrder="7" Text="정비보수의뢰" Top="545" Width="100"></Button>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_GovListExcel" BkColor2="default" BoldHead="FALSE" Border="Flat" Bottom="794" ColSizing="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="61" Id="grd_Excel" InputPanel="FALSE" Left="6" LineColor="default" LineType="ExVERT" MinWidth="100" MultiSelect="TRUE" OnCellClick="grd_List_OnExpandEdit" Right="3096" RowHeight="20" ScrollCell="true" SelColor="BACKGROUND" Style="grid" TabOrder="8" TabStop="true" Top="733" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="FALSE" VLineColor="default" WheelScrollRow="1" Width="3090">
			<contents>
				<format id="Default">
					<columns>
						<col width="120"/>
						<col width="120"/>
						<col width="120"/>
						<col width="140"/>
						<col width="120"/>
						<col width="120"/>
						<col width="150"/>
						<col width="355"/>
						<col width="150"/>
						<col width="100"/>
						<col width="100"/>
						<col width="120"/>
						<col width="100"/>
						<col width="200"/>
						<col width="100"/>
						<col width="200"/>
						<col width="200"/>
						<col width="80"/>
					</columns>
					<head>
						<cell col="0" display="text" text="정압실번호"/>
						<cell col="1" display="text" text="정압기번호"/>
						<cell col="2" display="text" text="계획일자"/>
						<cell col="3" display="text" text="팀"/>
						<cell col="4" display="text" text="구간"/>
						<cell col="5" display="text" text="시/구"/>
						<cell col="6" display="text" text="정압실명"/>
						<cell col="7" display="text" text="주소"/>
						<cell col="8" display="text" text="설치년월일"/>
						<cell col="9" display="normal" text="구"/>
						<cell col="10" display="text" text="검사일자"/>
						<cell col="11" display="text" text="검사결과"/>
						<cell col="12" display="normal" text="불합격&#32;일자"/>
						<cell col="13" display="text" text="사유"/>
						<cell col="14" display="text" text="조치일자"/>
						<cell col="15" display="text" text="조치내용"/>
						<cell col="16" display="text" text="비고"/>
						<cell col="17" display="text" text="정비보수번호"/>
					</head>
					<body>
						<cell col="0" colid="FACI_NUM" display="text"/>
						<cell col="1" colid="GOV_NUM" display="text"/>
						<cell align="center" col="2" colid="REG_INSPECT_PLAN_YMD" display="date"/>
						<cell align="center" col="3" colid="TEAM_NM" display="text"/>
						<cell align="center" col="4" colid="BLOCK_NM" display="text"/>
						<cell align="center" col="5" colid="ZIP_NO1" display="text" expandsize="18" wordwrap="word"/>
						<cell align="left" col="6" colid="GOV_ROOM_NM" display="text" expandsize="18" wordwrap="word"/>
						<cell align="left" col="7" colid="LOT_NUM_UNION" display="text" expandsize="18" wordwrap="word"/>
						<cell align="center" col="8" colid="INST_YMD" display="date"/>
						<cell align="center" col="9" colid="ZIP_NO1" display="normal" expandsize="18" wordwrap="word"/>
						<cell align="center" col="10" colid="INSPECT_YMD" display="date" expandimage="calendar" expandshow="true" expandsize="18" wordwrap="word"/>
						<cell align="center" col="11" colid="INSPECT_RSLT_CD" display="combo" edit="combo" expandsize="18" wordwrap="word"/>
						<cell align="center" col="12" colid="NOT_PASS_YMD" display="date" expandsize="18" wordwrap="word"/>
						<cell align="left" col="13" colid="NOT_PASS_WHY" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell align="center" col="14" colid="ACT_YMD" display="date" expandimage="calendar" expandshow="true" expandsize="18" wordwrap="word"/>
						<cell align="left" col="15" colid="ACT_DESC" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell align="left" col="16" colid="RMK" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell align="center" col="17" colid="MAINTER_NUM" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
	</Form>
	<Script><![CDATA[/***************************************************************************************************
* FormID     : D1301020010F_T02.xml
* Form 설명  : 정기 검사 정압기 결과를 조회 , 등록, 수정
* 시스템 명  : 안전공급 (D1)
* 작성자     : 김태화 
* 작성일     : 2008-12-26
* 변경내용   : 
****************************************************************************************************/

#include "JS::COMMONA10001.js";
#include "JS::COMMONA10002.js";
#include "JS::COMMOND10001.js";

//정기검사대상 시설에서 선택한 정압기에 대한 기본 정보
var StrInspectYear = "";
var strFaciNum = "";
var strGovNum = "";
var strZipNo1 = "";
var strFaciNm = "";
var saveFlag = 0;

//------------------------------------------------------------------------------- 
// 함수명: fn_Governor_History()
//   설명:  검사이력조회 팝업을 오픈 한다.
// arguments
//   return 내용: 없음
//------------------------------------------------------------------------------- 
// function fn_Governor_History()
// {
	// gfn_Dialog("D10","D1301030010U","",450,400,true,-1,-1);
// }

//------------------------------------------------------------------------------- 
// 함수명: fn_Maint_Repai_Reque()
//   설명:  정비보수의뢰 팝업을 오픈 한다.
// arguments
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_Maint_Repai_Reque()
{
	var str_MAINTER_NUM  = trim(ds_GovResult.GetColumn(ds_GovResult.row,"MAINTER_NUM")) ;
	
	var str_INSPECT_YEAR  = ds_GovResult.GetColumn(ds_GovResult.row, "INSPECT_YEAR");
	var str_FACI_NUM	  = ds_GovResult.GetColumn(ds_GovResult.row, "FACI_NUM"	   );
	var str_GOV_NUM		  = ds_GovResult.GetColumn(ds_GovResult.row, "GOV_NUM"	   );
	var str_INSPECT_FLAG  = "10";
	var str_INSPECT_YMD   = ds_GovResult.GetColumn(ds_GovResult.row, "INSPECT_YMD" );	          
	
	var str_BRANCH_CD     = ds_GovList.GetColumn(ds_GovList.row, "BRANCH_CD"   	   );	
	var str_TEAM_CD       = ds_GovList.GetColumn(ds_GovList.row, "TEAM_CD"     	   );
	var str_WORK_FIRM_CD  = ds_GovList.GetColumn(ds_GovList.row, "WORK_FIRM_CD"	   );
	var str_FACI_NUM 	  = ds_GovList.GetColumn(ds_GovList.row, "FACI_NUM"    	   );
	var str_FACI_NM  	  = ds_GovList.GetColumn(ds_GovList.row, "GOV_ROOM_NM"     );
	
	var str_ZIP_SEQ		  = ds_GovList.GetColumn(ds_GovList.row, "ZIP_SEQ"     	   );
	var str_ZIP_NO1       = ds_GovList.GetColumn(ds_GovList.row, "ZIP_NO1"     	   );
	var str_ZIP_NO2		  = ds_GovList.GetColumn(ds_GovList.row, "ZIP_NO2"	   	   );
	var str_HILL		  = ds_GovList.GetColumn(ds_GovList.row, "HILL"			   );
	var str_ADDR_M		  = ds_GovList.GetColumn(ds_GovList.row, "ADDR_M"		   );
	var str_ADDR_S   	  = ds_GovList.GetColumn(ds_GovList.row, "ADDR_S"		   );
	var str_SECOND_ADDR   = ds_GovList.GetColumn(ds_GovList.row, "SECOND_ADDR"	   );
	var str_BLD_DONG	  = ds_GovList.GetColumn(ds_GovList.row, "BLD_DONG"		   );
	var str_HOSU		  = ds_GovList.GetColumn(ds_GovList.row, "HOSU"			   );
	var str_LOT_NUM_UNION = ds_GovList.GetColumn(ds_GovList.row, "LOT_NUM_UNION"   );
	
	// ##############################################
	// 정비보수 화면 연계
	// ##############################################	
	
	var objDsName = gfn_D10_setDsObject_D1601010010F();
	
	eval(objDsName).SetColumn(0,"OPEN_FLAG"         ,"D1301030010F" 	); // 01. 구분 (지정된 화면)  
	eval(objDsName).SetColumn(0,"MAINTER_NUM"       ,str_MAINTER_NUM	); // 02. 정비보수번호        
	eval(objDsName).SetColumn(0,"BRANCH_CD"         ,str_BRANCH_CD  	); // 03. 지사코드            

	eval(objDsName).SetColumn(0,"TEAM_CD"           ,str_TEAM_CD      	); // 05. 팀코드              
	eval(objDsName).SetColumn(0,"WORK_FIRM_CD"      ,str_WORK_FIRM_CD	); // 06. 시공사코드
	eval(objDsName).SetColumn(0,"FACI_NUM"          ,str_FACI_NUM	 	); // 07. 시설물코드          
	eval(objDsName).SetColumn(0,"FACI_NM"           ,str_FACI_NM		); // 08. 시설물명            
	
	eval(objDsName).SetColumn(0,"ZIP_SEQ"           ,str_ZIP_SEQ		); // 09. 우편일련번호        
	eval(objDsName).SetColumn(0,"ZIP_NO1"           ,str_ZIP_NO1		); // 10. 우편번호1           
	eval(objDsName).SetColumn(0,"ZIP_NO2"           ,str_ZIP_NO2		); // 11. 우편번호2           
	eval(objDsName).SetColumn(0,"HILL"              ,str_HILL			); // 12. 산번지              
	eval(objDsName).SetColumn(0,"ADDR_M"            ,str_ADDR_M			); // 13. 본번                
	eval(objDsName).SetColumn(0,"ADDR_S"            ,str_ADDR_S			); // 14. 부번                
	eval(objDsName).SetColumn(0,"SECOND_ADDR"       ,str_SECOND_ADDR	); // 15. 보조주소            
	eval(objDsName).SetColumn(0,"BLD_DONG"          ,str_BLD_DONG		); // 16. 건물동              
	eval(objDsName).SetColumn(0,"HOSU"              ,str_HOSU			); // 17. 호수                
	eval(objDsName).SetColumn(0,"LOT_NUM_UNION"     ,str_LOT_NUM_UNION	); // 18. 지번주소조합        
	
	eval(objDsName).SetColumn(0,"PAVEMENT_KIND"     ,""					); // 19. 포장종류코드        
	eval(objDsName).SetColumn(0,"WORK_REQ_EMPID"    ,""					); // 20. 의뢰자ID            
	eval(objDsName).SetColumn(0,"WORK_REQ_EMPID_NM" ,""					); // 21. 의뢰자명  
	eval(objDsName).SetColumn(0,"KEY1"              ,str_INSPECT_YEAR	); // 22. PK1                 
	eval(objDsName).SetColumn(0,"KEY2"              ,str_FACI_NUM	 	); // 23. PK2                 
	eval(objDsName).SetColumn(0,"KEY3"              ,str_GOV_NUM	 	); // 24. PK3                 
	eval(objDsName).SetColumn(0,"KEY4"              ,str_INSPECT_FLAG	); // 25. PK4                 
	eval(objDsName).SetColumn(0,"KEY5"              ,str_INSPECT_YMD 	); // 26. PK5	
		
	// 화면 OPEN
	gfn_Form_D1601010010F(objDsName);
}

//------------------------------------------------------------------------------- 
// 함수명: fn_D1_SearchPlan()
//   설명:  정기 검사 대상 정압기을 조회한다.
// arguments
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_SearchPlan()
{	
	var strSvcID 	   = "fn_D1_Find";
	var strPart 	   = "D10";
	var strURL         = "handle.do?ServiceName=D1_RegulTestRsltRegisGoveMgr-service"
					   + "&BRANCH_CD="    + cob_Branch.Value
					   + "&ZIP_NO1="   	  + cob_ZipNo.Value
					   + "&INSPECT_YEAR=" + sp_Year.Value
					   + "&TEAM_CD="      + cob_Team.Value
					   + "&BLOCK_CD="	  + cob_PBlockCd.Value
					   ;
	var strInDatasets  = "";
	var strOutDatasets = "ds_GovList=ds_GovList ds_GovListExcel=ds_GovListExcel";
	var strArgument    = "findGov1";
	
	gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
			   
	if(ErrorCode < 0)
	{    
		return;
	}
	
	StrInspectYear = "";
	strFaciNum = "";
	strGovNum = "";
	strZipNo1 = "";
	strFaciNm = "";
	ds_GovResult.ClearData();
	
	if(ds_GovList.GetRowCount()==0)
	{
        grd_GovList.NoDataText="조회결과가 없습니다.";
        return;
    }
    
    grd_GovList_OnCellClick();
}

function grd_GovList_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	gfn_SetGrdComboBox_Comcode("grd_GovRst",4,"D10176");
	StrInspectYear = ds_GovList.GetColumn(nRow,"INSPECT_YEAR");
	strFaciNum = ds_GovList.GetColumn(nRow,"FACI_NUM");
	strGovNum = ds_GovList.GetColumn(nRow,"GOV_NUM");
	strZipNo1 = ds_GovList.GetColumn(nRow,"ZIP_NM");
	strFaciNm = ds_GovList.GetColumn(nRow,"GOV_ROOM_NM");
	fn_D1_ResultSearch(StrInspectYear, strFaciNum, strGovNum,strZipNo1,strFaciNm);
}

//------------------------------------------------------------------------------- 
// 함수명: fn_D1_ResultSearch(StrInspectYear, strFaciNum, strGovNum,strZipNo1,strFaciNm)
//   설명: 정기검사 결과등록을 조회 하는 함수
// arguments   
//          StrInspectYear: 검사년도
//          strFaciNum: 정압실번호
//          strGovNum: 정압기번호
//          strGovNum: 구
//          strGovNum: 시설물명
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_ResultSearch(StrInspectYear, strFaciNum, strGovNum,strZipNo1,strFaciNm)
{	
	ds_GovResult.ClearData();
	//-------------------------------------------------------------------------------
	//  Transition   : Service id
	//  ServicePart   : Service part
	//  Url   : Server url
	//  InputDsList   : Input Dataset List
	//  OutputDsList   : Output Dataset List;
	//  Argument   :  Argument
	//-------------------------------------------------------------------------------
    var strSvcID       = "fn_D1_ResultSearch";
    var strPart        = "D10";
    var strURL         = "handle.do?ServiceName=D1_RegulTestRsltRegisGoveMgr-service&FACI_NUM="+strFaciNum+"&GOV_NUM="+strGovNum+"&INSPECT_YEAR="+StrInspectYear+"&ZIP_NO1="+strZipNo1;
    var strInDatasets  = "";
    var strOutDatasets = "ds_GovResult=ds_GovResult";
    var strArgument    = "findResult";   
    
    gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
	if(ErrorCode < 0)
	{    
		return;
	}
	
	if(ds_GovResult.GetRowCount()==0)
	{
        grd_GovRst.NoDataText="조회결과가 없습니다.";
        return;
    }
    saveFlag = 0;
}

//---------------------------------------------------------
// 달력 팝업
//---------------------------------------------------------
function grd_List_OnExpandEdit(obj,nRow,nCell,strVal,nPivotIndex)
{
	if("INSPECT_YMD" == grd_GovRst.GetCellProp("body",nCell,"ColId"))
	{
		if(ds_GovResult.GetColumn(nRow,"INSPECT_FLAG") != "10")
		{
			gfn_SetCalendar(obj, nRow, nCell);
		}
	}else if("ACT_YMD" == grd_GovRst.GetCellProp("body",nCell,"ColId"))
	{
		if(ds_GovResult.GetColumn(nRow,"NOT_PASS_YN") != "N" && ds_GovResult.GetColumn(nRow,"INSPECT_RSLT_CD") == "20")
		{
			gfn_SetCalendar(obj, nRow, nCell);
		}
	}else if("INSPECT_RSLT_CD" == grd_GovRst.GetCellProp("body",nCell,"ColId"))
	{
		if(ds_GovResult.GetColumn(nRow,"INSPECT_FLAG") == "10")
		{
			grd_GovRst.SetCellProp("body",4,"Edit","none");
		}else
		{
			grd_GovRst.SetCellProp("body",4,"Edit","combo");
		}
	}else if("NOT_PASS_WHY" == grd_GovRst.GetCellProp("body",nCell,"ColId"))
	{
		if(ds_GovResult.GetColumn(nRow,"NOT_PASS_YN") != "N" && ds_GovResult.GetColumn(nRow,"INSPECT_RSLT_CD") == "20")
		{
			grd_GovRst.SetCellProp("body",6,"Edit","normal");
		}else
		{
			grd_GovRst.SetCellProp("body",6,"Edit","none");
		}
	}else if("ACT_DESC" == grd_GovRst.GetCellProp("body",nCell,"ColId"))
	{
		if(ds_GovResult.GetColumn(nRow,"NOT_PASS_YN") != "N" && ds_GovResult.GetColumn(nRow,"INSPECT_RSLT_CD") == "20")
		{
			grd_GovRst.SetCellProp("body",8,"Edit","normal");
		}else
		{
			grd_GovRst.SetCellProp("body",8,"Edit","none");
		}
	}
}

function ds_GovResult_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID == "INSPECT_RSLT_CD" && varNewValue == "20"){
		if(ds_GovResult.GetColumn(nRow,"INSPECT_YMD") == "" || ds_GovResult.GetColumn(nRow,"INSPECT_YMD") == null)
		{
			alert(gfn_GetMessage("M000011","%AAA%","검사일자를"));
			ds_GovResult.SetColumn(nRow,"INSPECT_RSLT_CD","10");
			return;
		}else{
			ds_GovResult.SetColumn(nRow,"NOT_PASS_YMD",ds_GovResult.GetColumn(nRow,"INSPECT_YMD"));
			grd_GovRst.SetCellProp("body",6,"Edit","normal");
			grd_GovRst.SetCellProp("body",8,"Edit","normal");
		}
	}else if(strColumnID == "INSPECT_RSLT_CD" && varNewValue == "10"){
		ds_GovResult.SetColumn(nRow,"NOT_PASS_YMD",NULL);
		ds_GovResult.SetColumn(nRow,"NOT_PASS_WHY",NULL);
		ds_GovResult.SetColumn(nRow,"ACT_YMD",NULL);
		ds_GovResult.SetColumn(nRow,"ACT_DESC",NULL);
		grd_GovRst.SetCellProp("body",6,"Edit","none");
		grd_GovRst.SetCellProp("body",8,"Edit","none");
	}
}

/*===============================================================================
 * 함수명: fn_D1_AddRow()
   설명: 정기검사 결과등록 레코드 한줄을 추가한다.
   return 내용: 없음
===============================================================================*/ 
function fn_D1_AddRow()
{
	if(strFaciNum != "")
	{
		gfn_SetGrdComboBox_Comcode("grd_GovRst",4,"D10176");
		ds_GovResult.InsertRow(0);
		ds_GovResult.SetColumn(0,"FACI_NUM",strFaciNum);
		ds_GovResult.SetColumn(0,"GOV_NUM",strGovNum);
		ds_GovResult.SetColumn(0,"ZIP_NO1",strZipNo1);
		ds_GovResult.SetColumn(0,"FACI_NM",strFaciNm);
		ds_GovResult.SetColumn(0,"INSPECT_YEAR",StrInspectYear);
		//ds_GovResult.SetColumn(0,"INSPECT_RSLT_CD","10");
    }else{
		alert('정기검사대상을 선택해주세요');
    }
}

/*===============================================================================
 * 함수명: fn_D1_DeleteRow()
   설명: 정기검사 결과등록 레코드 한줄을 삭제한다.
   return 내용: 없음
===============================================================================*/ 
function fn_D1_DeleteRow()
{
	var result = Confirm("데이터를 삭제하시겠습니까? ");
		
	if(result == '0'){
			return;
	}
	
	ds_GovResultD.ClearData();
	
	ds_GovResultD.AddRow();
	
	ds_GovResultD.CopyRow(0, "ds_GovResult", ds_GovResult.row, "");	
	ds_GovResult.DeleteRow(ds_GovResult.row);
			
	ds_GovResultD.UpdateControl = false;
	ds_GovResultD.SetRowType(0, "delete");
		
	var strSvcID = "saveGov";
	var strPart  = "D10";
	var strURL   = "handle.do?ServiceName=D1_RegulTestRsltRegisGoveMgr-service";
	var strInDatasets  = "ds_GovResult=ds_GovResultD:u";
	var strOutDatasets = "";
	var strArgument    = "savaGovRst";
	
	gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
			   
	if(ErrorCode < 0)
	{    
		return;
	}
	
	if(saveFlag == 0)
	{
		return;
	}
	
	gfn_SetStatusMsg(gfn_GetMessage("M000009","%AAA%","정상적으로 삭제를"),"black",true);
}

//------------------------------------------------------------------------------- 
// 함수명: fn_D1_SaveReg()
//   설명: 정기검사계획 결과등록 내용을 등록 및 수정한다.
// arguments   
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_SaveReg()
{		
	if(strFaciNum != "")
	{
		var temp_1;
		var temp_2;
		
		for(var i=0; i<ds_GovResult.GetRowCount(); i++){

			temp_1 = trim(ds_GovResult.GetColumn(i,"INSPECT_YMD"));	
		
			for(var j=0; j<=i; j++){			
				if(i != j){				
					temp_2 = trim(ds_GovResult.GetColumn(j,"INSPECT_YMD"));
				
					if(temp_1 == temp_2){
						alert("검사일자가 동일한 경우에는 등록하실 수 없습니다. 검사일자가 중복되지 않도록 선택해 주십시오. ");
						return;
					}
				}
			}
		}
		
		for(var i=0; i<ds_GovResult.RowCount(); i++)
		{		
		if(ds_GovResult.GetRowType(i) == "insert"){
			var str_FACI_NUM     = ds_GovResult.GetColumn(i, "FACI_NUM"    );
			var str_GOV_NUM		 = ds_GovResult.GetColumn(i, "GOV_NUM"     );
			var str_INSPECT_YEAR = ds_GovResult.GetColumn(i, "INSPECT_YEAR");
			var str_INSPECT_YMD  = ds_GovResult.GetColumn(i, "INSPECT_YMD" );
						
			fn_D1_CheckReg(str_FACI_NUM, str_GOV_NUM, str_INSPECT_YEAR, str_INSPECT_YMD);
	
				//등록되어 있을 경우
				if (ds_GovRstFlag.GetRowCount() > 0){	
					var str_CRTDTM = ds_GovRstFlag.GetColumn(0, "CRT_TIME" );
					var str_CRTNM  = ds_GovRstFlag.GetColumn(0, "CRT_EMPNM");
					
					var str_INSPECT_YMD  = substr(ds_GovResult.GetColumn(i,"INSPECT_YMD"), 0, 4);
						str_INSPECT_YMD	+= "년 ";
						str_INSPECT_YMD	+= substr(ds_GovResult.GetColumn(i,"INSPECT_YMD"), 4, 2);
						str_INSPECT_YMD	+= "월 ";
						str_INSPECT_YMD	+= substr(ds_GovResult.GetColumn(i,"INSPECT_YMD"), 6, 2);
						str_INSPECT_YMD	+= "일";
					alert("검사일자 " + str_INSPECT_YMD + "에 대한 결과 데이터는 \n" + str_CRTNM + "님께서 " + str_CRTDTM + "에 이미 등록하신 데이터입니다. \n데이터를 조회해 주십시오. ");
					return;
				}					
			}
		}
	}
	
	if(strFaciNum != "")
	{
		for(var i=0; i<ds_GovResult.RowCount(); i++)
		{			
			if(ds_GovResult.GetRowType(i) == "insert"){
								
				if(ds_GovResult.GetColumn(i,"INSPECT_YMD") == "" || ds_GovResult.GetColumn(i,"INSPECT_YMD") == null)
				{
					alert(gfn_GetMessage("M000011","%AAA%","검사일자를"));
					return;
				}
				
				if(!fn_DateCheckTodayGrid(ds_GovResult.GetColumn(i,"INSPECT_YMD"),"검사일자"))
				{
					return;
				}
				
				if(ds_GovResult.GetColumn(i,"INSPECT_RSLT_CD") == "" || ds_GovResult.GetColumn(i,"INSPECT_RSLT_CD") == null)
				{
					alert(gfn_GetMessage("M000011","%AAA%","검사결과"));
					return;
				}
				
				if(ds_GovResult.GetColumn(i,"ACT_YMD") != "" && ds_GovResult.GetColumn(i,"ACT_YMD") != null)
				{
					if(ds_GovResult.GetColumn(i,"INSPECT_YMD") > ds_GovResult.GetColumn(i,"ACT_YMD"))
					{
						alert('조치일자가 검사일자 보다 커야 합니다..');
						return;
					}
					if(!fn_DateCheckTodayGrid(ds_GovResult.GetColumn(i,"ACT_YMD"),"조치일자"))
					{
						return;
					}
				}
				
				//수정 등록시 셋팅할 사용자 정보
				ds_GovResult.SetColumn(i, "UPD_EMPID", gfn_GetGlobalValue("G_USER_NO"));
				ds_GovResult.SetColumn(i, "UPD_IP"   , gfn_GetGlobalValue("G_IPADDRESS"));
				ds_GovResult.SetColumn(i, "CRT_EMPID", gfn_GetGlobalValue("G_USER_NO"));
				ds_GovResult.SetColumn(i, "CRT_IP"   , gfn_GetGlobalValue("G_IPADDRESS"));
				
				saveFlag = 1;
				
			}else if(ds_GovResult.GetRowType(i) == "update")
			{
				if((ds_GovResult.GetColumn(i,"ACT_YMD") == "" || ds_GovResult.GetColumn(i,"ACT_YMD") == null) && ds_GovResult.GetColumn(i,"INSPECT_RSLT_CD") == "20")
				{
					alert(gfn_GetMessage("M000011","%AAA%","조치일자를"));
					return;
				}
				
				if(ds_GovResult.GetColumn(i,"ACT_YMD") != "" && ds_GovResult.GetColumn(i,"ACT_YMD") != null)
				{
					if(ds_GovResult.GetColumn(i,"INSPECT_YMD") > ds_GovResult.GetColumn(i,"ACT_YMD"))
					{
						alert('조치일자가 검사일자 보다 커야 합니다..');
						return;
					}
					if(!fn_DateCheckTodayGrid(ds_GovResult.GetColumn(i,"ACT_YMD"),"조치일자"))
					{
						return;
					}
				}
				
				//수정시 셋팅할 사용자 정보
				ds_GovResult.SetColumn(i, "UPD_EMPID", gfn_GetGlobalValue("G_USER_NO"));
				ds_GovResult.SetColumn(i, "UPD_IP", gfn_GetGlobalValue("G_IPADDRESS"));
				
				saveFlag = 1;
			}
		}
	}else{
		//alert('상세화면 조회 후 가능합니다.');
		return;
	}
		
	var strSvcID = "saveGov";
	var strPart = "D10";
	var strURL = "handle.do?ServiceName=D1_RegulTestRsltRegisGoveMgr-service";
	var strInDatasets  = "ds_GovResult=ds_GovResult:u";
	var strOutDatasets  = "";
	var strArgument  = "savaGovRst";
	
	gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
			   
	if(ErrorCode < 0)
	{    
		return;
	}
	
	if(ds_GovResult.RowCount() == 0)
	{
		return;
	}
	
	if(saveFlag == 0)
	{
		return;
	}
	
	gfn_SetStatusMsg(gfn_GetMessage("M000009","%AAA%","정상적으로 저장을"),"black",true);
	
	fn_D1_ResultSearch(StrInspectYear, strFaciNum, strGovNum,strZipNo1,strFaciNm);
}

//------------------------------------------------------------------------------- 
// 함수명: fn_D1_CheckReg()
//   설명: 정기검사 결과등록을 하기 전 기 등록 여부 확인
// arguments   
//          index: 선택된 행
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_CheckReg(str_FACI_NUM, str_GOV_NUM, str_INSPECT_YEAR, str_INSPECT_YMD)
{	
	//-------------------------------------------------------------------------------
	//  Transition   : Service id
	//  ServicePart   : Service part
	//  Url   : Server url
	//  InputDsList   : Input Dataset List
	//  OutputDsList   : Output Dataset List;
	//  Argument   :  Argument
	//-------------------------------------------------------------------------------
	
	ds_GovRstFlag.ClearData();
	
    var strSvcID        = "fn_D1_CheckReg";
    var strPart         = "D10";
    var strURL          = "handle.do?ServiceName=D1_RegulTestRsltRegisGoveMgr-service";
		strURL		   += "&FACI_NUM="    + str_FACI_NUM    ;
		strURL		   += "&GOV_NUM="     + str_GOV_NUM	    ;
		strURL		   += "&INSPECT_YEAR="+ str_INSPECT_YEAR;
		strURL		   += "&INSPECT_YMD=" + str_INSPECT_YMD ;
					   
    var strInDatasets   = "";
    var strOutDatasets  = "ds_GovRstFlag=ds_GovRstFlag";
    var strArgument     = "findRstFlag";   
    
    gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
}

function D1301030010F_OnUnloadCompleted(obj)
{
	if(ds_GovResult.GetUpdate()){
		if(!confirm(gfn_GetMessage("M000016","%AAA%","변경된 내용이 있습니다.종료")))
		{
			return false;
		}
	}
}

function fn_D1_ExcelExport()
{
	var SearchCondition= "";

    SearchCondition = SearchCondition + "지사 :"  + RPad(cob_Branch.Text," ",20);
    SearchCondition = SearchCondition + "시/구 :" + RPad(cob_ZipNo.Text," ",20);
    SearchCondition = SearchCondition + "팀 :"    + RPad(cob_Team.Text," ",20);
    SearchCondition = SearchCondition + "구간 :"  + RPad(cob_PBlockCd.Text," ",20);
    SearchCondition = SearchCondition + "년도 :"  + RPad(sp_Year.Text," ",20);
	gfn_ExportExcel("정기검사결과등록 정압기 ", 5, SearchCondition, "grd_Excel"); 
}
function D1301030010F_OnLoadCompleted(obj)
{
	gfn_D1_SetGrid_Sort(grd_GovList);
	gfn_D1_SetGrid_Sort(grd_GovRst);
}]]></Script>
</Window>