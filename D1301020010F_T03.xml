<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="729" Id="D1301040010F" Left="8" OnLoadCompleted="D1301040010F_OnLoadCompleted" OnUnloadCompleted="D1301040010F_OnUnloadCompleted" PidAttrib="7" Top="8" Ver="1.0" Width="1260" WorkArea="false">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_HouseList">
				<Contents>
					<colinfo id="REG_INSPECT_PLAN_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="CO_LIVE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="BURY_LENG" size="256" summ="default" type="STRING"/>
					<colinfo id="EXPOS_LENG" size="256" summ="default" type="STRING"/>
					<colinfo id="DONG_QTY" size="256" summ="default" type="STRING"/>
					<colinfo id="HOUSE_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="LOT_NUM_UNION" size="256" summ="default" type="STRING"/>
					<colinfo id="LEAK_YN" size="256" summ="default" type="STRING"/>
					<colinfo id="BRANCH_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="WORK_FIRM_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_NO1" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_NO2" size="256" summ="default" type="STRING"/>
					<colinfo id="HILL" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR_M" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR_S" size="256" summ="default" type="STRING"/>
					<colinfo id="SECOND_ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="BLD_DONG" size="256" summ="default" type="STRING"/>
					<colinfo id="HOSU" size="256" summ="default" type="STRING"/>
					<colinfo id="MATER_FLAG_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_HouseResult" OnColumnChanged="ds_HouseResult_OnColumnChanged">
				<Contents>
					<colinfo id="INSPECT_YEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="FACI_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="INSPECT_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="UPD_EMPID" size="256" summ="default" type="STRING"/>
					<colinfo id="UPD_IP" size="256" summ="default" type="STRING"/>
					<colinfo id="CRT_EMPID" size="256" summ="default" type="STRING"/>
					<colinfo id="CRT_IP" size="256" summ="default" type="STRING"/>
					<colinfo id="INSPECT" size="256" summ="default" type="STRING"/>
					<colinfo id="NOT_PASS_WHY" size="256" summ="default" type="STRING"/>
					<colinfo id="ACT_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="ACT_DESC" size="256" summ="default" type="STRING"/>
					<colinfo id="RMK" size="256" summ="default" type="STRING"/>
					<colinfo id="NOT_PASS_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="MAINTER_NUM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_HouseRstFlag">
				<Contents>
					<colinfo id="CRT_TIME" size="256" summ="default" type="STRING"/>
					<colinfo id="CRT_EMPNM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_HouseListExcel">
				<Contents>
					<colinfo id="REG_INSPECT_PLAN_YMD" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_NO1" size="256" summ="default" type="STRING"/>
					<colinfo id="CO_LIVE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="BURY_LENG" size="256" summ="default" type="STRING"/>
					<colinfo id="EXPOS_LENG" size="256" summ="default" type="STRING"/>
					<colinfo id="DONG_QTY" size="256" summ="default" type="STRING"/>
					<colinfo id="HOUSE_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="LOT_NUM_UNION" size="256" summ="default" type="STRING"/>
					<colinfo id="MAINTER_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="SAFE_OFFICE_NUM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_HouseResultD" OnColumnChanged="ds_HouseResult_OnColumnChanged">
				<Contents>
					<colinfo id="INSPECT_YEAR" size="256" type="STRING"/>
					<colinfo id="FACI_NUM" size="256" type="STRING"/>
					<colinfo id="INSPECT_YMD" size="256" type="STRING"/>
					<colinfo id="UPD_EMPID" size="256" type="STRING"/>
					<colinfo id="UPD_IP" size="256" type="STRING"/>
					<colinfo id="CRT_EMPID" size="256" type="STRING"/>
					<colinfo id="CRT_IP" size="256" type="STRING"/>
					<colinfo id="INSPECT" size="256" type="STRING"/>
					<colinfo id="NOT_PASS_WHY" size="256" type="STRING"/>
					<colinfo id="ACT_YMD" size="256" type="STRING"/>
					<colinfo id="ACT_DESC" size="256" type="STRING"/>
					<colinfo id="RMK" size="256" type="STRING"/>
					<colinfo id="NOT_PASS_YMD" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="Dataset0"></Dataset>
		</Datasets>
		<Shape BKColor="#6cbae1" Bottom="29" Height="3" Id="Shape0" Left="5" LineWidth="0" Right="1243" TabOrder="2" Top="26" Type="Rectangle" Width="1238"></Shape>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_HouseList" BkColor2="user3" BoldHead="FALSE" Border="Flat" Bottom="541" ColSizing="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="512" Id="grd_HouseList" InputPanel="FALSE" Left="5" LineColor="default" LineType="ExVERT" MinWidth="100" MultiSelect="TRUE" OnCellClick="grd_HouseList_OnCellClick" Right="1243" ScrollCell="true" SelColor="BACKGROUND" Style="grid" TabOrder="1" TabStop="true" Top="29" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1238">
			<contents>
				<format id="Default">
					<columns>
						<col fix="left" width="40"/>
						<col width="100"/>
						<col width="100"/>
						<col width="255"/>
						<col width="90"/>
						<col width="90"/>
						<col width="70"/>
						<col width="70"/>
						<col width="70"/>
						<col width="250"/>
						<col width="70"/>
					</columns>
					<head>
						<cell col="0" display="normal" text="NO"/>
						<cell col="1" display="text" text="계획일자"/>
						<cell col="2" display="text" text="시/구"/>
						<cell col="3" display="text" text="공동주택명"/>
						<cell col="4" display="text" text="배관연장(m)"/>
						<cell col="5" display="text" text="인입연장(m)"/>
						<cell col="6" display="text" text="재질"/>
						<cell col="7" display="text" text="동수"/>
						<cell col="8" display="text" text="세대수"/>
						<cell col="9" display="text" text="주소"/>
						<cell col="10" display="text" text="기밀대상"/>
					</head>
					<body>
						<cell align="right" col="0" display="normal" expandsize="18" expr="rowindex+1" wordwrap="word"/>
						<cell align="center" col="1" colid="REG_INSPECT_PLAN_YMD" display="date"/>
						<cell align="center" col="2" colid="ZIP_NM" display="text" expandsize="18" wordwrap="word"/>
						<cell align="left" col="3" colid="CO_LIVE_NM" display="text" expandsize="18" wordwrap="word"/>
						<cell align="right" col="4" colid="BURY_LENG" display="number" expandsize="18" wordwrap="word"/>
						<cell align="right" col="5" colid="EXPOS_LENG" display="number" expandsize="18" wordwrap="word"/>
						<cell align="center" col="6" colid="MATER_FLAG_NM" display="text" expandsize="18" wordwrap="word"/>
						<cell align="right" col="7" colid="DONG_QTY" display="number" expandsize="18" wordwrap="word"/>
						<cell align="right" col="8" colid="HOUSE_CNT" display="number"/>
						<cell align="left" col="9" colid="LOT_NUM_UNION" display="text" expandsize="18" wordwrap="word"/>
						<cell align="center" col="10" colid="LEAK_YN" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Image Align="Left" Height="10" Id="Image5" ImageID="blt_8" Left="5" LeftMargin="12" Style="text_title" TabOrder="3" Text="정기검사대상(공동주택)" Top="5" Width="210"></Image>
		<Image Align="Left" Height="10" Id="Image0" ImageID="blt_8" Left="4" LeftMargin="12" Style="text_title" TabOrder="6" Text="정기검사결과&#32;등록" Top="548" Width="210"></Image>
		<Shape BKColor="#6cbae1" Bottom="571" Height="3" Id="Shape3" Left="5" LineWidth="0" Right="1243" TabOrder="5" Top="568" Type="Rectangle" Width="1238"></Shape>
		<Grid AutoEnter="TRUE" BindDataset="ds_HouseResult" BkColor2="default" BoldHead="FALSE" Border="Flat" Bottom="720" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="149" Id="grd_HouseRst" InputPanel="FALSE" Left="5" LineColor="default" LineType="ExVERT" MultiSelect="TRUE" OnCellClick="grd_List_OnExpandEdit" Right="1243" RowHeight="20" ScrollCell="true" SelColor="BACKGROUND" Style="grid" TabOrder="4" TabStop="true" Top="571" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1238">
			<contents>
				<format id="Default">
					<columns>
						<col width="40"/>
						<col width="100"/>
						<col width="403"/>
						<col width="353"/>
						<col width="138"/>
						<col width="100"/>
						<col width="100"/>
						<col width="299"/>
						<col width="122"/>
						<col width="287"/>
						<col width="200"/>
						<col width="100"/>
					</columns>
					<head>
						<cell col="0" display="normal" text="NO"/>
						<cell col="1" display="normal" text="시/구"/>
						<cell col="2" display="text" text="공동주택명"/>
						<cell col="3" display="normal" text="주소"/>
						<cell bkcolor="user11" col="4" display="text" text="검사일자"/>
						<cell bkcolor="user11" col="5" display="text" text="검사결과"/>
						<cell col="6" display="normal" text="불합격일자"/>
						<cell col="7" display="text" text="사유"/>
						<cell col="8" display="text" text="조치일자"/>
						<cell col="9" display="text" text="조치내용"/>
						<cell col="10" display="text" text="비고"/>
						<cell col="11" display="text" text="정비보수번호"/>
					</head>
					<body>
						<cell align="right" col="0" display="normal" expandsize="18" expr="rowindex+1" wordwrap="word"/>
						<cell align="center" col="1" colid="ZIP_NO1" display="normal" expandsize="18" wordwrap="word"/>
						<cell align="left" col="2" colid="FACI_NM" display="text" expandsize="18" wordwrap="word"/>
						<cell align="left" col="3" colid="LOT_NUM_UNION" display="normal" expandsize="18" wordwrap="word"/>
						<cell align="center" col="4" colid="INSPECT_YMD" display="date" expandimage="calendar" expandshow="true" expandsize="18" wordwrap="word"/>
						<cell align="center" col="5" colid="INSPECT_RSLT_CD" display="combo" edit="combo" expandsize="18" wordwrap="word"/>
						<cell align="center" col="6" colid="NOT_PASS_YMD" display="date" expandsize="18" wordwrap="word"/>
						<cell align="left" col="7" colid="NOT_PASS_WHY" display="text" edit="normal" expandsize="18" limit="30" wordwrap="word"/>
						<cell align="center" col="8" colid="ACT_YMD" display="date" expandimage="calendar" expandshow="true" expandsize="18" wordwrap="word"/>
						<cell align="left" col="9" colid="ACT_DESC" display="text" edit="normal" expandsize="18" limit="30" wordwrap="word"/>
						<cell align="left" col="10" colid="RMK" display="text" edit="normal" expandsize="18" limit="30" wordwrap="word"/>
						<cell align="center" col="11" colid="MAINTER_NUM" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="19" Id="Button223" ImageID="btn_6_reg" Left="1043" LeftMargin="21" OnClick="fn_Maint_Repai_Reque" Style="button" TabOrder="7" Text="정비보수의뢰" Top="545" Width="100"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="19" Id="Button0" ImageID="btn_6_reg" Left="1143" LeftMargin="21" OnClick="fn_Rst_Imp" Style="button" TabOrder="8" Text="개선권고관리" Top="545" Width="100"></Button>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_HouseListExcel" BkColor2="default" BoldHead="FALSE" Border="Flat" Bottom="784" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="45" Id="grd_Excel" InputPanel="FALSE" Left="5" LineColor="default" LineType="ExVERT" MinWidth="100" MultiSelect="TRUE" OnCellClick="grd_List_OnExpandEdit" Right="1888" RowHeight="20" ScrollCell="true" SelColor="BACKGROUND" Style="grid" TabOrder="9" TabStop="true" Top="739" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="FALSE" VLineColor="default" WheelScrollRow="1" Width="1883">
			<contents>
				<format id="Default">
					<columns>
						<col width="100"/>
						<col width="100"/>
						<col width="100"/>
						<col width="150"/>
						<col width="100"/>
						<col width="100"/>
						<col width="100"/>
						<col width="100"/>
						<col width="250"/>
						<col width="123"/>
						<col width="100"/>
						<col width="100"/>
						<col width="299"/>
						<col width="122"/>
						<col width="287"/>
						<col width="200"/>
						<col width="100"/>
						<col width="80"/>
					</columns>
					<head>
						<cell col="0" display="text" text="공동주택번호"/>
						<cell col="1" display="text" text="계획일자"/>
						<cell col="2" display="text" text="시/구"/>
						<cell col="3" display="text" text="공동주택명"/>
						<cell col="4" display="text" text="배관연장(m)"/>
						<cell col="5" display="text" text="인입연장(m)"/>
						<cell col="6" display="text" text="동수"/>
						<cell col="7" display="text" text="세대수"/>
						<cell col="8" display="text" text="주소"/>
						<cell col="9" display="text" text="검사일자"/>
						<cell col="10" display="text" text="검사결과"/>
						<cell col="11" display="normal" text="불합격&#32;일자"/>
						<cell col="12" display="text" text="사유"/>
						<cell col="13" display="text" text="조치일자"/>
						<cell col="14" display="text" text="조치내용"/>
						<cell col="15" display="text" text="비고"/>
						<cell col="16" display="text" text="정비보수번호"/>
						<cell col="17" display="text" text="안전공사번호"/>
					</head>
					<body>
						<cell align="center" col="0" colid="FACI_NUM" display="text"/>
						<cell align="center" col="1" colid="REG_INSPECT_PLAN_YMD" display="date"/>
						<cell align="center" col="2" colid="ZIP_NO1" display="text" expandsize="18" wordwrap="word"/>
						<cell align="left" col="3" colid="CO_LIVE_NM" display="text" expandsize="18" wordwrap="word"/>
						<cell align="right" col="4" colid="BURY_LENG" display="number" expandsize="18" wordwrap="word"/>
						<cell align="right" col="5" colid="EXPOS_LENG" display="number" expandsize="18" wordwrap="word"/>
						<cell align="right" col="6" colid="DONG_QTY" display="number" expandsize="18" wordwrap="word"/>
						<cell align="right" col="7" colid="HOUSE_CNT" display="number"/>
						<cell align="left" col="8" colid="LOT_NUM_UNION" display="text" expandsize="18" wordwrap="word"/>
						<cell align="center" col="9" colid="INSPECT_YMD" display="date" expandimage="calendar" expandshow="true" expandsize="18" wordwrap="word"/>
						<cell align="center" col="10" colid="INSPECT_RSLT_CD" display="combo" edit="combo" expandsize="18" wordwrap="word"/>
						<cell align="center" col="11" colid="NOT_PASS_YMD" display="date" expandsize="18" wordwrap="word"/>
						<cell align="left" col="12" colid="NOT_PASS_WHY" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell align="center" col="13" colid="ACT_YMD" display="date" expandimage="calendar" expandshow="true" expandsize="18" wordwrap="word"/>
						<cell align="left" col="14" colid="ACT_DESC" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell align="left" col="15" colid="RMK" display="text" edit="normal" expandsize="18" wordwrap="word"/>
						<cell align="center" col="16" colid="MAINTER_NUM" display="text"/>
						<cell align="center" col="17" colid="SAFE_OFFICE_NUM" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
	</Form>
	<Script><![CDATA[/***************************************************************************************************
* FormID     : D1301020010F_T03.xml
* Form 설명  : 정기 검사 공동주택 결과를 조회 , 등록, 수정
* 시스템 명  : 안전공급 (D1)
* 작성자     : 김태화 
* 작성일     : 2008-12-26
* 변경내용   : 
****************************************************************************************************/

#include "JS::COMMONA10001.js";
#include "JS::COMMONA10002.js";
#include "JS::COMMOND10001.js";

//정기검사대상 시설에서 선택한 정압기에 대한 기본 정보
var StrInspectYear = "";
var strFaciNum = "";
var strLotNumUnion = "";
var strZipNo1 = "";
var strFaciNm = "";
var strRow = 0;
var saveFlag = 0;

//------------------------------------------------------------------------------- 
// 함수명: fn_APT_History()
//   설명:  검사이력조회 팝업을 오픈 한다.
// arguments
//   return 내용: 없음
//------------------------------------------------------------------------------- 
// function fn_APT_History()
// {
	// gfn_Dialog("D10","D1301040011U","",450,400,true,-1,-1);
// }

//------------------------------------------------------------------------------- 
// 함수명: fn_Maint_Repai_Reque()
//   설명:  정비보수의뢰 팝업을 오픈 한다.
// arguments
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_Maint_Repai_Reque()
{
	var str_MAINTER_NUM  = trim(ds_HouseResult.GetColumn(ds_HouseResult.row,"MAINTER_NUM")) ;
	
	var str_INSPECT_YEAR  = ds_HouseResult.GetColumn(ds_HouseResult.row, "INSPECT_YEAR");
	var str_FACI_NUM	  = ds_HouseResult.GetColumn(ds_HouseResult.row, "FACI_NUM"	   );
	var str_INSPECT_FLAG  = "10";
	var str_INSPECT_YMD   = ds_HouseResult.GetColumn(ds_HouseResult.row, "INSPECT_YMD" );
		
	var str_BRANCH_CD     = ds_HouseList.GetColumn(ds_HouseList.row, "BRANCH_CD"   	   );
	var str_WORK_FIRM_CD  = ds_HouseList.GetColumn(ds_HouseList.row, "WORK_FIRM_CD"	   );
	var str_FACI_NUM 	  = ds_HouseList.GetColumn(ds_HouseList.row, "FACI_NUM"    	   );
	var str_FACI_NM  	  = ds_HouseList.GetColumn(ds_HouseList.row, "CO_LIVE_NM"      );
	
	var str_ZIP_SEQ		  = ds_HouseList.GetColumn(ds_HouseList.row, "ZIP_SEQ"     	   );
	var str_ZIP_NO1       = ds_HouseList.GetColumn(ds_HouseList.row, "ZIP_NO1"     	   );
	var str_ZIP_NO2		  = ds_HouseList.GetColumn(ds_HouseList.row, "ZIP_NO2"	   	   );
	var str_HILL		  = ds_HouseList.GetColumn(ds_HouseList.row, "HILL"			   );
	var str_ADDR_M		  = ds_HouseList.GetColumn(ds_HouseList.row, "ADDR_M"		   );
	var str_ADDR_S   	  = ds_HouseList.GetColumn(ds_HouseList.row, "ADDR_S"		   );
	var str_SECOND_ADDR   = ds_HouseList.GetColumn(ds_HouseList.row, "SECOND_ADDR"	   );
	var str_BLD_DONG	  = ds_HouseList.GetColumn(ds_HouseList.row, "BLD_DONG"		   );
	var str_HOSU		  = ds_HouseList.GetColumn(ds_HouseList.row, "HOSU"			   );
	var str_LOT_NUM_UNION = ds_HouseList.GetColumn(ds_HouseList.row, "LOT_NUM_UNION"   );
	
	// ##############################################
	// 정비보수 화면 연계
	// ##############################################	
	
	var objDsName = gfn_D10_setDsObject_D1601010010F();
	
	eval(objDsName).SetColumn(0,"OPEN_FLAG"         ,"D1301040010F" 	); // 01. 구분 (지정된 화면)  
	eval(objDsName).SetColumn(0,"MAINTER_NUM"       ,str_MAINTER_NUM	); // 02. 정비보수번호        
	eval(objDsName).SetColumn(0,"BRANCH_CD"         ,str_BRANCH_CD  	); // 03. 지사코드            

	eval(objDsName).SetColumn(0,"TEAM_CD"           ,""			      	); // 05. 팀코드              
	eval(objDsName).SetColumn(0,"WORK_FIRM_CD"      ,str_WORK_FIRM_CD	); // 06. 시공사코드
	eval(objDsName).SetColumn(0,"FACI_NUM"          ,str_FACI_NUM	 	); // 07. 시설물코드          
	eval(objDsName).SetColumn(0,"FACI_NM"           ,str_FACI_NM		); // 08. 시설물명            
	
	eval(objDsName).SetColumn(0,"ZIP_SEQ"           ,str_ZIP_SEQ		); // 09. 우편일련번호        
	eval(objDsName).SetColumn(0,"ZIP_NO1"           ,str_ZIP_NO1		); // 10. 우편번호1           
	eval(objDsName).SetColumn(0,"ZIP_NO2"           ,str_ZIP_NO2		); // 11. 우편번호2           
	eval(objDsName).SetColumn(0,"HILL"              ,str_HILL			); // 12. 산번지              
	eval(objDsName).SetColumn(0,"ADDR_M"            ,str_ADDR_M			); // 13. 본번                
	eval(objDsName).SetColumn(0,"ADDR_S"            ,str_ADDR_S			); // 14. 부번                
	eval(objDsName).SetColumn(0,"SECOND_ADDR"       ,str_SECOND_ADDR	); // 15. 보조주소            
	eval(objDsName).SetColumn(0,"BLD_DONG"          ,str_BLD_DONG		); // 16. 건물동              
	eval(objDsName).SetColumn(0,"HOSU"              ,str_HOSU			); // 17. 호수                
	eval(objDsName).SetColumn(0,"LOT_NUM_UNION"     ,str_LOT_NUM_UNION	); // 18. 지번주소조합        
	
	eval(objDsName).SetColumn(0,"PAVEMENT_KIND"     ,""					); // 19. 포장종류코드        
	eval(objDsName).SetColumn(0,"WORK_REQ_EMPID"    ,""					); // 20. 의뢰자ID            
	eval(objDsName).SetColumn(0,"WORK_REQ_EMPID_NM" ,""					); // 21. 의뢰자명  
	eval(objDsName).SetColumn(0,"KEY1"              ,str_INSPECT_YEAR	); // 22. PK1                 
	eval(objDsName).SetColumn(0,"KEY2"              ,str_FACI_NUM	 	); // 23. PK2                 
	eval(objDsName).SetColumn(0,"KEY3"              ,str_INSPECT_FLAG 	); // 24. PK3                 
	eval(objDsName).SetColumn(0,"KEY4"              ,str_INSPECT_YMD	); // 25. PK4                 
	eval(objDsName).SetColumn(0,"KEY5"              ,"" 				); // 26. PK5	
		
	// 화면 OPEN
	gfn_Form_D1601010010F(objDsName);
}

//------------------------------------------------------------------------------- 
// 함수명: fn_Rst_Imp()
//   설명:  개선권고관리 팝업을 오픈 한다.
// arguments
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_Rst_Imp()
{
	if(ds_HouseResult.GetColumn(strRow,"INSPECT_RSLT_CD") == "20")
	{
		var args  = "INSPECT_YEAR="  +quote(ds_HouseResult.GetColumn(strRow,"INSPECT_YEAR"));
			args += " FACI_NUM="     +quote(ds_HouseResult.GetColumn(strRow,"FACI_NUM"));
			args += " INSPECT_YMD="  +quote(ds_HouseResult.GetColumn(strRow,"INSPECT_YMD"));
			args += " LOT_NUM_UNION="+quote(strLotNumUnion);
			args += " CO_LIVE_NM="   +quote(strFaciNm);
			args += " INSPECT_FLAG=10";
		gfn_Dialog("D10","D1301040010U",args,680,304,true,-1,-1);
	}
}

//------------------------------------------------------------------------------- 
// 함수명: fn_D1_SearchPlan()
//   설명:  정기 검사 대상 공동주택을 조회한다.
// arguments
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_SearchPlan()
{	
	var strSvcID = "fn_D1_Find";
	var strPart = "D10";
	var strURL = "handle.do?ServiceName=D1_RegulTestRsltRegisCoLiveMgr-service&BRANCH_CD="+cob_Branch.Value+"&ZIP_NO1="+cob_ZipNo.Value+"&INSPECT_YEAR="+sp_Year.Value;
	var strInDatasets  = "";
	var strOutDatasets  = "ds_HouseList=ds_HouseList ds_HouseListExcel=ds_HouseListExcel";
	var strArgument  = "findHouse1";
	
	gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
			   
	if(ErrorCode < 0)
	{    
		return;
	}
	
	StrInspectYear = "";
	strFaciNum = "";
	strLotNumUnion = "";
	strZipNo1 = "";
	strFaciNm = "";
	strRow = 0;
	ds_HouseResult.ClearData();
	
	if(ds_HouseList.GetRowCount()==0)
	{
        grd_HouseList.NoDataText="조회결과가 없습니다.";
        return;
    }
    
    grd_HouseList_OnCellClick();
    //fn_D1_LeakHouse();
}

//------------------------------------------------------------------------------- 
// 함수명: fn_D1_LeakHouse()
//   설명:  정기 검사 중 누설 기밀대상을 선정한다.
// arguments
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_LeakHouse()
{
   //그리드에서 항목제외 맨마지막(감추기로)2010.1.25  정우현과장
	var strInstYear = 0;
	var strBaseYear = parseInt(sp_Year.Value);
	
	for(var i=0;i<ds_HouseList.RowCount();i++)
	{		
		if(parseInt(ds_HouseList.GetColumn(i,"INST_YMD")) <1995)
		{
			strInstYear = 1995;
		}else
		{
			strInstYear = parseInt(substr(ds_HouseList.GetColumn(i,"INST_YMD"),0,4));
		}
		
		if((strBaseYear - strInstYear) % 3 == 0)
		{
			ds_HouseList.SetColumn(i,"LEAK_YN","기밀");
		}else{
			ds_HouseList.SetColumn(i,"LEAK_YN","누출");
		}
	}
}

function grd_HouseList_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	gfn_SetGrdComboBox_Comcode("grd_HouseRst",5,"D10176");
	StrInspectYear = ds_HouseList.GetColumn(nRow,"INSPECT_YEAR");
	strFaciNum     = ds_HouseList.GetColumn(nRow,"FACI_NUM");
	strZipNo1      = ds_HouseList.GetColumn(nRow,"ZIP_NM");
	strFaciNm      = ds_HouseList.GetColumn(nRow,"CO_LIVE_NM");
	strLotNumUnion = ds_HouseList.GetColumn(nRow,"LOT_NUM_UNION");
	fn_D1_ResultSearch(StrInspectYear, strFaciNum, strZipNo1,strFaciNm,strLotNumUnion);
}

//------------------------------------------------------------------------------- 
// 함수명: fn_D1_ResultSearch(StrInspectYear, strFaciNum, strZipNo1,strFaciNm),strLotNumUnion
//   설명: 정기검사 결과등록을 조회 하는 함수
// arguments   
//          StrInspectYear: 검사년도
//          strFaciNum: 공동주택번호
//          strZipNo1: 구
//          strFaciNm: 시설물명
//          strLotNumUnion: 주소
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_ResultSearch(StrInspectYear, strFaciNum, strZipNo1,strFaciNm,strLotNumUnion)
{	
	ds_HouseResult.ClearData();
	//-------------------------------------------------------------------------------
	//  Transition   : Service id
	//  ServicePart   : Service part
	//  Url   : Server url
	//  InputDsList   : Input Dataset List
	//  OutputDsList   : Output Dataset List;
	//  Argument   :  Argument
	//-------------------------------------------------------------------------------
    var strSvcID     = "fn_D1_ResultSearch";
    var strPart     = "D10";
    var strURL             = "handle.do?ServiceName=D1_RegulTestRsltRegisCoLiveMgr-service&FACI_NUM="+strFaciNum+"&INSPECT_YEAR="+StrInspectYear+"&ZIP_NO1="+strZipNo1+"&FACI_NM="+strFaciNm+"&LOT_NUM_UNION="+strLotNumUnion;
    var strInDatasets     = "";
    var strOutDatasets = "ds_HouseResult=ds_HouseResult";
    var strArgument      = "findResult";   
    
    gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
			   
	if(ErrorCode < 0)
	{    
		return;
	}
	
	if(ds_HouseResult.GetRowCount()==0)
	{
        grd_HouseRst.NoDataText="조회결과가 없습니다.";
        return;
    }
    saveFlag = 0;
}

//---------------------------------------------------------
// 달력 팝업
//---------------------------------------------------------
function grd_List_OnExpandEdit(obj,nRow,nCell,strVal,nPivotIndex)
{
	strRow = nRow;
	if("INSPECT_YMD" == grd_HouseRst.GetCellProp("body",nCell,"ColId"))
	{
		if(ds_HouseResult.GetColumn(nRow,"INSPECT_FLAG") != "10")
		{
			gfn_SetCalendar(obj, nRow, nCell);
		}
	}else if("ACT_YMD" == grd_HouseRst.GetCellProp("body",nCell,"ColId"))
	{
		if(ds_HouseResult.GetColumn(nRow,"NOT_PASS_YN") != "N" && ds_HouseResult.GetColumn(nRow,"INSPECT_RSLT_CD") == "20")
		{
			gfn_SetCalendar(obj, nRow, nCell);
		}
	}else if("INSPECT_RSLT_CD" == grd_HouseRst.GetCellProp("body",nCell,"ColId"))
	{
		if(ds_HouseResult.GetColumn(nRow,"INSPECT_FLAG") == "10")
		{
			grd_HouseRst.SetCellProp("body",5,"Edit","none");
		}else
		{
			grd_HouseRst.SetCellProp("body",5,"Edit","combo");
		}
	}else if("NOT_PASS_WHY" == grd_HouseRst.GetCellProp("body",nCell,"ColId"))
	{
		if(ds_HouseResult.GetColumn(nRow,"NOT_PASS_YN") != "N" && ds_HouseResult.GetColumn(nRow,"INSPECT_RSLT_CD") == "20")
		{
			grd_HouseRst.SetCellProp("body",7,"Edit","normal");
		}else
		{
			grd_HouseRst.SetCellProp("body",7,"Edit","none");
		}
	}else if("ACT_DESC" == grd_HouseRst.GetCellProp("body",nCell,"ColId"))
	{
		if(ds_HouseResult.GetColumn(nRow,"NOT_PASS_YN") != "N" && ds_HouseResult.GetColumn(nRow,"INSPECT_RSLT_CD") == "20")
		{
			grd_HouseRst.SetCellProp("body",9,"Edit","normal");
		}else
		{
			grd_HouseRst.SetCellProp("body",9,"Edit","none");
		}
	}
}

function ds_HouseResult_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID == "INSPECT_RSLT_CD" && varNewValue == "20"){
		if(ds_HouseResult.GetColumn(nRow,"INSPECT_YMD") == "" || ds_HouseResult.GetColumn(nRow,"INSPECT_YMD") == null)
		{
			alert(gfn_GetMessage("M000011","%AAA%","검사일자를"));
			ds_HouseResult.SetColumn(nRow,"INSPECT_RSLT_CD","10");
			return;
		}else{
			ds_HouseResult.SetColumn(nRow,"NOT_PASS_YMD",ds_HouseResult.GetColumn(nRow,"INSPECT_YMD"));
			grd_HouseRst.SetCellProp("body",7,"Edit","normal");
			grd_HouseRst.SetCellProp("body",9,"Edit","normal");
		}
	}else if(strColumnID == "INSPECT_RSLT_CD" && varNewValue == "10"){
		ds_HouseResult.SetColumn(nRow,"NOT_PASS_YMD",NULL);
		ds_HouseResult.SetColumn(nRow,"NOT_PASS_WHY",NULL);
		ds_HouseResult.SetColumn(nRow,"ACT_YMD",NULL);
		ds_HouseResult.SetColumn(nRow,"ACT_DESC",NULL);
		grd_HouseRst.SetCellProp("body",7,"Edit","none");
		grd_HouseRst.SetCellProp("body",9,"Edit","none");
	}
}

/*===============================================================================
 * 함수명: fn_D1_AddRow()
   설명: 정기검사 결과등록 레코드 한줄을 추가한다.
   return 내용: 없음
===============================================================================*/ 
function fn_D1_AddRow()
{
	if(strFaciNum != "")
	{
		gfn_SetGrdComboBox_Comcode("grd_HouseRst",5,"D10176");
		ds_HouseResult.InsertRow(0);
		ds_HouseResult.SetColumn(0,"FACI_NUM"	  ,strFaciNum);
		ds_HouseResult.SetColumn(0,"LOT_NUM_UNION",strLotNumUnion);
		ds_HouseResult.SetColumn(0,"ZIP_NO1"       ,strZipNo1);
		ds_HouseResult.SetColumn(0,"FACI_NM"	  ,strFaciNm);
		ds_HouseResult.SetColumn(0,"INSPECT_YEAR" ,StrInspectYear);
		//ds_HouseResult.SetColumn(0,"INSPECT_RSLT_CD","10");
    }else{
		alert('정기검사대상을 선택해주세요');
    }
}

/*===============================================================================
 * 함수명: fn_D1_DeleteRow()
   설명: 정기검사 결과등록 레코드 한줄을 삭제한다.
   return 내용: 없음
===============================================================================*/ 
function fn_D1_DeleteRow()
{
	var result = Confirm("데이터를 삭제하시겠습니까? ");
		
	if(result == '0'){
			return;
	}
	
	ds_HouseResultD.ClearData();
	
	ds_HouseResultD.AddRow();
	
	ds_HouseResultD.CopyRow(0, "ds_HouseResult", ds_HouseResult.row, "");	
	ds_HouseResult.DeleteRow(ds_HouseResult.row);
			
	ds_HouseResultD.UpdateControl = false;
	ds_HouseResultD.SetRowType(0, "delete");
		
	var strSvcID  = "saveHouse";
	var strPart   = "D10";
	var strURL    = "handle.do?ServiceName=D1_RegulTestRsltRegisCoLiveMgr-service";
	var strInDatasets  = "ds_HouseResult=ds_HouseResultD:u";
	var strOutDatasets = "";
	var strArgument    = "savaHouseRst";
	
	gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
			   
	if(ErrorCode < 0)
	{    
		return;
	}
	
	if(saveFlag == 0)
	{
		return;
	}
	
	gfn_SetStatusMsg(gfn_GetMessage("M000009","%AAA%","정상적으로 삭제를"),"black",true);
}


//------------------------------------------------------------------------------- 
// 함수명: fn_D1_SaveReg()
//   설명: 정기검사계획 결과등록 내용을 등록 및 수정한다.
// arguments   
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_SaveReg()
{
	if(strFaciNum != "")
	{
		var temp_1;
		var temp_2;
		
		for(var i=0; i<ds_HouseResult.GetRowCount(); i++){

			temp_1 = trim(ds_HouseResult.GetColumn(i,"INSPECT_YMD"));	
		
			for(var j=0; j<=i; j++){			
				if(i != j){				
					temp_2 = trim(ds_HouseResult.GetColumn(j,"INSPECT_YMD"));
				
					if(temp_1 == temp_2){
						alert("검사일자가 동일한 경우에는 등록하실 수 없습니다. 검사일자가 중복되지 않도록 선택해 주십시오. ");
						return;
					}
				}
			}
		}
		
		for(var i=0; i<ds_HouseResult.RowCount(); i++)
		{		
		if(ds_HouseResult.GetRowType(i) == "insert"){
			var str_FACI_NUM     = ds_HouseResult.GetColumn(i, "FACI_NUM"    );
			var str_INSPECT_YEAR = ds_HouseResult.GetColumn(i, "INSPECT_YEAR");
			var str_INSPECT_YMD  = ds_HouseResult.GetColumn(i, "INSPECT_YMD" );
						
			fn_D1_CheckReg(str_FACI_NUM, str_INSPECT_YEAR, str_INSPECT_YMD);
	
				//등록되어 있을 경우
				if (ds_HouseRstFlag.GetRowCount() > 0){	
					var str_CRTDTM = ds_HouseRstFlag.GetColumn(0, "CRT_TIME" );
					var str_CRTNM  = ds_HouseRstFlag.GetColumn(0, "CRT_EMPNM");
					
					var str_INSPECT_YMD  = substr(ds_HouseResult.GetColumn(i,"INSPECT_YMD"), 0, 4);
						str_INSPECT_YMD	+= "년 ";
						str_INSPECT_YMD	+= substr(ds_HouseResult.GetColumn(i,"INSPECT_YMD"), 4, 2);
						str_INSPECT_YMD	+= "월 ";
						str_INSPECT_YMD	+= substr(ds_HouseResult.GetColumn(i,"INSPECT_YMD"), 6, 2);
						str_INSPECT_YMD	+= "일";
					alert("검사일자 " + str_INSPECT_YMD + "에 대한 결과 데이터는 \n" + str_CRTNM + "님께서 " + str_CRTDTM + "에 이미 등록하신 데이터입니다. \n데이터를 조회해 주십시오. ");
					return;
				}					
			}
		}
	}
	
	if(strFaciNum != "")
	{
		for(var i=0; i<ds_HouseResult.RowCount(); i++)
		{
			if(ds_HouseResult.GetRowType(i) == "insert")
			{
				var strChkFlag = fn_D1_CheckReg();
				
				if(!strChkFlag) 
				{
					alert('이미 등록된 검사일자입니다.');
					return;
				}
				if(ds_HouseResult.GetColumn(i,"INSPECT_YMD") == "" || ds_HouseResult.GetColumn(i,"INSPECT_YMD") == null)
				{
					alert(gfn_GetMessage("M000011","%AAA%","검사일자를"));
					return;
				}
				
				if(!fn_DateCheckTodayGrid(ds_HouseResult.GetColumn(i,"INSPECT_YMD"),"검사일자"))
				{
					return;
				}
				
				if(ds_HouseResult.GetColumn(i,"INSPECT_RSLT_CD") == "" || ds_HouseResult.GetColumn(i,"INSPECT_RSLT_CD") == null)
				{
					alert(gfn_GetMessage("M000011","%AAA%","검사결과를"));
					return;
				}
				
				if(ds_HouseResult.GetColumn(i,"ACT_YMD") != "" && ds_HouseResult.GetColumn(i,"ACT_YMD") != null)
				{
					if(ds_HouseResult.GetColumn(i,"INSPECT_YMD") > ds_HouseResult.GetColumn(i,"ACT_YMD"))
					{
						alert('조치일자가 검사일자 보다 커야 합니다..');
						return;
					}
					if(!fn_DateCheckTodayGrid(ds_HouseResult.GetColumn(i,"ACT_YMD"),"조치일자"))
					{
						return;
					}
				}
				
				//수정 등록시 셋팅할 사용자 정보
				ds_HouseResult.SetColumn(i, "UPD_EMPID", gfn_GetGlobalValue("G_USER_NO"));
				ds_HouseResult.SetColumn(i, "UPD_IP", gfn_GetGlobalValue("G_IPADDRESS"));
				ds_HouseResult.SetColumn(i, "CRT_EMPID", gfn_GetGlobalValue("G_USER_NO"));
				ds_HouseResult.SetColumn(i, "CRT_IP", gfn_GetGlobalValue("G_IPADDRESS"));
				
				saveFlag = 1;
			}else if(ds_HouseResult.GetRowType(i) == "update")
			{
				if(ds_HouseResult.GetColumn(i,"ACT_YMD") == "" || ds_HouseResult.GetColumn(i,"ACT_YMD") == null)
				{
					alert(gfn_GetMessage("M000011","%AAA%","조치일자를"));
					return;
				}
				
				if(ds_HouseResult.GetColumn(i,"ACT_YMD") != "" && ds_HouseResult.GetColumn(i,"ACT_YMD") != null)
				{
					if(ds_HouseResult.GetColumn(i,"INSPECT_YMD") > ds_HouseResult.GetColumn(i,"ACT_YMD"))
					{
						alert('조치일자가 검사일자 보다 커야 합니다..');
						return;
					}
					if(!fn_DateCheckTodayGrid(ds_HouseResult.GetColumn(i,"ACT_YMD"),"조치일자"))
					{
						return;
					}
				}
				
				//수정시 셋팅할 사용자 정보
				ds_HouseResult.SetColumn(i, "UPD_EMPID", gfn_GetGlobalValue("G_USER_NO"));
				ds_HouseResult.SetColumn(i, "UPD_IP", gfn_GetGlobalValue("G_IPADDRESS"));
				
				saveFlag = 1;
			}
		}
	}else{
		//alert('상세화면 조회 후 가능합니다.');
		return;
	}
	
	var strSvcID  = "saveHouse";
	var strPart   = "D10";
	var strURL    = "handle.do?ServiceName=D1_RegulTestRsltRegisCoLiveMgr-service";
	var strInDatasets  = "ds_HouseResult=ds_HouseResult:u";
	var strOutDatasets = "";
	var strArgument    = "savaHouseRst";
	
	gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
	
	if(ErrorCode < 0)
	{    
		return;
	}
	
	if(ds_HouseResult.RowCount() == 0)
	{
		return;
	}
	
	if(saveFlag == 0)
	{
		return;
	}
	
	gfn_SetStatusMsg(gfn_GetMessage("M000009","%AAA%","정상적으로 저장을"),"black",true);
	
	fn_D1_ResultSearch(StrInspectYear, strFaciNum, strZipNo1,strFaciNm,strLotNumUnion);
}

//------------------------------------------------------------------------------- 
// 함수명: fn_D1_CheckReg()
//   설명: 정기검사 결과등록을 하기 전 기 등록 여부 확인
// arguments   
//          index: 선택된 행
//   return 내용: 없음
//------------------------------------------------------------------------------- 
function fn_D1_CheckReg(str_FACI_NUM, str_INSPECT_YEAR, str_INSPECT_YMD)
{	
	//-------------------------------------------------------------------------------
	//  Transition   : Service id
	//  ServicePart   : Service part
	//  Url   : Server url
	//  InputDsList   : Input Dataset List
	//  OutputDsList   : Output Dataset List;
	//  Argument   :  Argument
	//-------------------------------------------------------------------------------
    var strSvcID       = "fn_D1_CheckReg";
    var strPart        = "D10";
    var strURL         = "handle.do?ServiceName=D1_RegulTestRsltRegisCoLiveMgr-service";
		strURL        += "&FACI_NUM="     + str_FACI_NUM     ;
		strURL		  += "&INSPECT_YEAR=" + str_INSPECT_YEAR ;
		strURL		  += "&INSPECT_YMD="  + str_INSPECT_YMD  ;
    var strInDatasets  = "";
    var strOutDatasets = "ds_HouseRstFlag=ds_HouseRstFlag";
    var strArgument    = "findRstFlag";   
    gfn_SyncCall( 
					 strSvcID
				   , strPart
				   , strURL
				   , strInDatasets
				   , strOutDatasets
				   , strArgument
			   );
	if(ds_HouseRstFlag.RowCount() != 0) return false;
	return true;
}


function D1301040010F_OnUnloadCompleted(obj)
{
	if(ds_HouseResult.GetUpdate()){
		if(!confirm(gfn_GetMessage("M000016","%AAA%","변경된 내용이 있습니다.종료")))
		{
			return false;
		}
	}
}


function fn_D1_ExcelExport()
{
	var SearchCondition= "";

    SearchCondition = SearchCondition + "지사 :" + RPad(cob_Branch.Text," ",20);
    SearchCondition = SearchCondition + "시/구 :" + RPad(cob_ZipNo.Text," ",20);
    SearchCondition = SearchCondition + "년도 :" + RPad(sp_Year.Text," ",20);
	gfn_ExportExcel("정기검사결과등록 공동주택 ", 5, SearchCondition, "grd_Excel"); 
}
function D1301040010F_OnLoadCompleted(obj)
{
	gfn_D1_SetGrid_Sort(grd_HouseList);
	gfn_D1_SetGrid_Sort(grd_HouseRst);
}
]]></Script>
</Window>